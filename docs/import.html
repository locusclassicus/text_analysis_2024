<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Импорт: JSON &amp; XML – Компьютерный анализ текста</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./share.html" rel="next">
<link href="./iterate.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./import.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Импорт: JSON &amp; XML</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Поиск" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Компьютерный анализ текста</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Поиск"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Введение</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Начало работы</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tabular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Таблицы</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Визуализации</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iterate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Циклы, условия, функции</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Импорт: JSON &amp; XML</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./share.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Публикационная система Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Регулярные выражения</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scrape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Веб-скрапинг</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tokenize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Токенизация, лемматизация, POS-тэггинг и синтаксический анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Распределения слов и анализ частотностей</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sentiment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Эмоциональная тональность</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lsa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Латентно-семантический анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pmi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Векторные представления слов на основе PMI. Word2Vec.</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Тематическое моделирование c LDA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Кластеризация и метод главных компонент</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stylo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Стилометрический анализ с пакетом <code>stylo</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./consensus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Консенсусные деревья и сети</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./igraph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Сетевые данные в <code>igraph</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggraph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Графический дизайн сетей в <code>ggraph</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dracor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Анализ сетей и обнаружение сообществ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Пространственные данные в R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Регрессионный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Регрессионные модели с <code>tidymodels</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Литература</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#json" id="toc-json" class="nav-link active" data-scroll-target="#json"><span class="header-section-number">5.1</span> JSON</a>
  <ul class="collapse">
  <li><a href="#пакет-jsonlite" id="toc-пакет-jsonlite" class="nav-link" data-scroll-target="#пакет-jsonlite"><span class="header-section-number">5.1.1</span> Пакет <code>jsonlite</code></a></li>
  <li><a href="#от-списка-к-таблице" id="toc-от-списка-к-таблице" class="nav-link" data-scroll-target="#от-списка-к-таблице"><span class="header-section-number">5.1.2</span> От списка к таблице</a></li>
  <li><a href="#датасет-шедевры-пушкинского-музея" id="toc-датасет-шедевры-пушкинского-музея" class="nav-link" data-scroll-target="#датасет-шедевры-пушкинского-музея"><span class="header-section-number">5.1.3</span> Датасет: Шедевры Пушкинского музея</a></li>
  </ul></li>
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml"><span class="header-section-number">5.2</span> XML</a>
  <ul class="collapse">
  <li><a href="#библиотека-xml" id="toc-библиотека-xml" class="nav-link" data-scroll-target="#библиотека-xml"><span class="header-section-number">5.2.1</span> Библиотека <code>XML</code></a></li>
  <li><a href="#выбор-элементов" id="toc-выбор-элементов" class="nav-link" data-scroll-target="#выбор-элементов"><span class="header-section-number">5.2.2</span> Выбор элементов</a></li>
  <li><a href="#значения-узлов-и-атрибутов" id="toc-значения-узлов-и-атрибутов" class="nav-link" data-scroll-target="#значения-узлов-и-атрибутов"><span class="header-section-number">5.2.3</span> Значения узлов и атрибутов</a></li>
  <li><a href="#обход-дерева-узлов" id="toc-обход-дерева-узлов" class="nav-link" data-scroll-target="#обход-дерева-узлов"><span class="header-section-number">5.2.4</span> Обход дерева узлов</a></li>
  <li><a href="#синтаксис-xpath" id="toc-синтаксис-xpath" class="nav-link" data-scroll-target="#синтаксис-xpath"><span class="header-section-number">5.2.5</span> Синтаксис XPath</a></li>
  <li><a href="#от-дерева-к-таблице" id="toc-от-дерева-к-таблице" class="nav-link" data-scroll-target="#от-дерева-к-таблице"><span class="header-section-number">5.2.6</span> От дерева к таблице</a></li>
  <li><a href="#разметка-tei" id="toc-разметка-tei" class="nav-link" data-scroll-target="#разметка-tei"><span class="header-section-number">5.2.7</span> Разметка TEI</a></li>
  <li><a href="#датасет-война-и-мир" id="toc-датасет-война-и-мир" class="nav-link" data-scroll-target="#датасет-война-и-мир"><span class="header-section-number">5.2.8</span> Датасет: “Война и мир”</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Импорт: JSON &amp; XML</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Ранее мы научились импортировать табличные данные с расширениями .csv и .tsv. Подробнее об импорте таблиц, текстов и изображений можно посмотреть <a href="https://locusclassicus.github.io/text_analysis_2023/%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82-%D0%B8-%D1%8D%D0%BA%D1%81%D0%BF%D0%BE%D1%80%D1%82-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85.html">предыдущую версию</a> курса. В этом уроке речь пойдет о работе со структурированными данными.</p>
<section id="json" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="json"><span class="header-section-number">5.1</span> JSON</h2>
<p>Формат JSON (JavaScript Object Notation) предназначен для представления структурированных данных. JSON имеет шесть основных <a href="https://r4ds.hadley.nz/rectangling#json">типов данных</a>. Четыре из них - скаляры:</p>
<ul>
<li>cамый простой тип - <code>null</code>, который играет ту же роль, что и <code>NA</code> в R. Он представляет собой отсутствие данных;</li>
<li>cтрока (string) похожа на строку в R, но в ней всегда должны использоваться двойные кавычки;</li>
<li>число аналогично числам в R, при этом поддерживается целочисленная (например, 123), десятичная (например, 123.45) или научная (например, 1,23e3) нотация. JSON не поддерживает <code>Inf</code>, <code>-Inf</code> или <code>NaN</code>;</li>
<li>логическое значение аналогично <code>TRUE</code> и <code>FALSE</code> в R, но использует строчные буквы <code>true</code> и <code>false</code>.</li>
</ul>
<p>Строки, числа и булевы значения в JSON очень похожи на символьные, числовые и логические векторы в R. Основное отличие заключается в том, что скаляры JSON могут представлять только одно значение. Для представления нескольких значений необходимо использовать один из двух оставшихся типов: массивы и объекты.</p>
<p>И массивы, и объекты похожи на списки в R, разница заключается в том, именованы они или нет. <em>Массив</em> подобен безымянному списку и записывается через <code>[]</code>. Например, <code>[1, 2, 3]</code> - это массив, содержащий 3 числа, а <code>[null, 1, "string", false]</code> - массив, содержащий ноль, число, строку и булево значение.</p>
<p><em>Объект</em> подобен именованному списку и записывается через <code>{}</code>. Имена (ключи в терминологии JSON) являются строками, поэтому должны быть заключены в кавычки. Например, {“x”: 1, “y”: 2} - это объект, который сопоставляет x с 1, а y – с 2.</p>
<section id="пакет-jsonlite" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="пакет-jsonlite"><span class="header-section-number">5.1.1</span> Пакет <code>jsonlite</code></h3>
<p>Загрузим небольшой файл <code>TBBT.json</code>, хранящий данные о сериале “Теория большого взрыва” (<a href="https://gist.github.com/sahithyandev/540c82170a19f97deef9e23796083f01">источник</a>). Скачать лучше из репозитория курса <a href="https://github.com/locusclassicus/text_analysis_2024/blob/main/files/TBBT.json">ссылка</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"../files/TBBT.json"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tbbt <span class="ot">&lt;-</span> <span class="fu">read_json</span>(path)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Функция <code>read_json()</code> вернула нам список со следующими элементами:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tbbt)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Length Class  Mode     
name                        1    -none- character
season_count                1    -none- character
episodes_count_total        1    -none- character
episodes_count_per_season  12    -none- list     
casting                    11    -none- list     
episode_list              280    -none- list     
references                  1    -none- list     </code></pre>
</div>
</div>
</section>
<section id="от-списка-к-таблице" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="от-списка-к-таблице"><span class="header-section-number">5.1.2</span> От списка к таблице</h3>
<p>Выборочно преобразуем список в тиббл. Функция <code>transpose()</code> берет <em>список списков</em> и выворачивает его наизнанку: вместо списка, в котором для каждого из персонажей указан актер и первое появление, мы получаем три списка: с персонажами, актерами и эпизодами. На месте отсутствующих значений ставится NULL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cast_tbl <span class="ot">&lt;-</span> tbbt<span class="sc">$</span>casting <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transpose</span>() <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(as.character) <span class="sc">|&gt;</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>cast_tbl</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["character_name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["actor_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["first_appearance"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Sheldon Cooper","2":"Jim Parsons","3":"S01E01"},{"1":"Leonard Hofstadter","2":"Johnny Galecki","3":"S01E01"},{"1":"Penny","2":"Kaley Cuoco","3":"S01E01"},{"1":"Raj Kooththirapll","2":"Kunal Nayyar","3":"S01E01"},{"1":"Howard Wolowitz","2":"Simon Helberg","3":"S01E01"},{"1":"Bernadette Rostenkowski","2":"Melissa Rauch","3":"S03E05"},{"1":"Amy Farrah Fowler","2":"Mayim Bialik","3":"S03E23"},{"1":"Stuart Bloom","2":"Kevin Sussman","3":"NULL"},{"1":"Wil Wheaton","2":"Wil Wheaton","3":"NULL"},{"1":"Barry Kripke","2":"John Ross Bowie","3":"NULL"},{"1":"Zack","2":"NULL","3":"NULL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Проделаем то же самое для списка эпизодов, но другим способом. Функция <code>pluck()</code> представляет собой аналог <code>[[</code>, который можно использовать в пайпе. Она позволяет эффективно индексировать многоуровневые списки. Поскольку списков много, мы используем ее в сочетании с <code>map_chr()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>episodes_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">episode_id =</span> <span class="fu">map_chr</span>(tbbt<span class="sc">$</span>episode_list, pluck, <span class="st">"episode_id"</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">map_chr</span>(tbbt<span class="sc">$</span>episode_list, pluck, <span class="st">"title"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>episodes_tbl</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["episode_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["title"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"S01E01","2":"Pilot"},{"1":"S01E02","2":"The Big Bran Hypothesis"},{"1":"S01E03","2":"The Fuzzy Boots Corollary"},{"1":"S01E04","2":"The Luminous Fish Effect"},{"1":"S01E05","2":"The Hamburger Postulate"},{"1":"S01E06","2":"The Middle-Earth Paradigm"},{"1":"S01E07","2":"The Dumpling Paradox"},{"1":"S01E08","2":"The Grasshopper Experiment"},{"1":"S01E09","2":"The Cooper-Hofstadter Polarization"},{"1":"S01E10","2":"The Loobenfeld Decay"},{"1":"S01E11","2":"The Pancake Batter Anomaly"},{"1":"S01E12","2":"The Jerusalem Duality"},{"1":"S01E13","2":"The Bat Jar Conjecture"},{"1":"S01E14","2":"The Nerdvana Annihilation"},{"1":"S01E15","2":"The Shiksa Indeterminacy, The Pork Chop Indeterminacy"},{"1":"S01E16","2":"The Peanut Reaction"},{"1":"S01E17","2":"The Tangerine Factor"},{"1":"S02E01","2":"The Bad Fish Paradigm"},{"1":"S02E02","2":"The Codpiece Topology"},{"1":"S02E03","2":"The Barbarian Sublimation"},{"1":"S02E04","2":"The Griffin Equivalency"},{"1":"S02E05","2":"The Euclid Alternative"},{"1":"S02E06","2":"The Cooper–Nowitzki Theorem"},{"1":"S02E07","2":"The Panty Piñata Polarization"},{"1":"S02E08","2":"The Lizard–Spock Expansion"},{"1":"S02E09","2":"The White Asparagus Triangulation"},{"1":"S02E10","2":"The Vartabedian Conundrum"},{"1":"S02E11","2":"The Bath Item Gift Hypothesis"},{"1":"S02E12","2":"The Killer Robot Instability"},{"1":"S02E13","2":"The Friendship Algorithm"},{"1":"S02E14","2":"The Financial Permeability"},{"1":"S02E15","2":"The Maternal Capacitance"},{"1":"S02E16","2":"The Cushion Saturation"},{"1":"S02E17","2":"The Terminator Decoupling"},{"1":"S02E18","2":"The Work Song Nanocluster"},{"1":"S02E19","2":"The Dead Hooker Juxtaposition"},{"1":"S02E20","2":"The Hofstadter Isotope"},{"1":"S02E21","2":"The Vegas Renormalization"},{"1":"S02E22","2":"The Classified Materials Turbulence"},{"1":"S02E23","2":"The Monopolar Expedition"},{"1":"S03E01","2":"The Electric Can Opener Fluctuation"},{"1":"S03E02","2":"The Jiminy Conjecture"},{"1":"S03E03","2":"The Gothowitz Deviation"},{"1":"S03E04","2":"The Pirate Solution"},{"1":"S03E05","2":"The Creepy Candy Coating Corollary"},{"1":"S03E06","2":"The Cornhusker Vortex"},{"1":"S03E07","2":"The Guitarist Amplification"},{"1":"S03E08","2":"The Adhesive Duck Deficiency"},{"1":"S03E09","2":"The Vengeance Formulation"},{"1":"S03E10","2":"The Gorilla Experiment"},{"1":"S03E11","2":"The Maternal Congruence"},{"1":"S03E12","2":"The Psychic Vortex"},{"1":"S03E13","2":"The Bozeman Reaction"},{"1":"S03E14","2":"The Einstein Approximation"},{"1":"S03E15","2":"The Large Hadron Collision"},{"1":"S03E16","2":"The Excelsior Acquisition"},{"1":"S03E17","2":"The Precious Fragmentation"},{"1":"S03E18","2":"The Pants Alternative"},{"1":"S03E19","2":"The Wheaton Recurrence"},{"1":"S03E20","2":"The Spaghetti Catalyst"},{"1":"S03E21","2":"The Plimpton Stimulation"},{"1":"S03E22","2":"The Staircase Implementation"},{"1":"S03E23","2":"The Lunar Excitation"},{"1":"S04E01","2":"The Robotic Manipulation"},{"1":"S04E02","2":"The Cruciferous Vegetable Amplification"},{"1":"S04E03","2":"The Zazzy Substitution"},{"1":"S04E04","2":"The Hot Troll Deviation"},{"1":"S04E05","2":"The Desperation Emanation"},{"1":"S04E06","2":"The Irish Pub Formulation"},{"1":"S04E07","2":"The Apology Insufficiency"},{"1":"S04E08","2":"The 21-Second Excitation"},{"1":"S04E09","2":"The Boyfriend Complexity"},{"1":"S04E10","2":"The Alien Parasite Hypothesis"},{"1":"S04E11","2":"The Justice League Recombination"},{"1":"S04E12","2":"The Bus Pants Utilization"},{"1":"S04E13","2":"The Love Car Displacement"},{"1":"S04E14","2":"The Thespian Catalyst"},{"1":"S04E15","2":"The Benefactor Factor"},{"1":"S04E16","2":"The Cohabitation Formulation"},{"1":"S04E17","2":"The Toast Derivation"},{"1":"S04E18","2":"The Prestidigitation Approximation"},{"1":"S04E19","2":"The Zarnecki Incursion"},{"1":"S04E20","2":"The Herb Garden Germination"},{"1":"S04E21","2":"The Agreement Dissection"},{"1":"S04E22","2":"The Wildebeest Implementation"},{"1":"S04E23","2":"The Engagement Reaction"},{"1":"S04E24","2":"The Roommate Transmogrification"},{"1":"S05E01","2":"The Skank Reflex Analysis"},{"1":"S05E02","2":"The Infestation Hypothesis"},{"1":"S05E03","2":"The Pulled Groin Extrapolation"},{"1":"S05E04","2":"The Wiggly Finger Catalyst"},{"1":"S05E05","2":"The Russian Rocket Reaction"},{"1":"S05E06","2":"The Rhinitis Revelation"},{"1":"S05E07","2":"The Good Guy Fluctuation"},{"1":"S05E08","2":"The Isolation Permutation"},{"1":"S05E09","2":"The Ornithophobia Diffusion"},{"1":"S05E10","2":"The Flaming Spittoon Acquisition"},{"1":"S05E11","2":"The Speckerman Recurrence"},{"1":"S05E12","2":"The Shiny Trinket Maneuver"},{"1":"S05E13","2":"The Recombination Hypothesis"},{"1":"S05E14","2":"The Beta Test Initiation"},{"1":"S05E15","2":"The Friendship Contraction"},{"1":"S05E16","2":"The Vacation Solution"},{"1":"S05E17","2":"The Rothman Disintegration"},{"1":"S05E18","2":"The Werewolf Transformation"},{"1":"S05E19","2":"The Weekend Vortex"},{"1":"S05E20","2":"The Transporter Malfunction"},{"1":"S05E21","2":"The Hawking Excitation"},{"1":"S05E22","2":"The Stag Convergence"},{"1":"S05E23","2":"The Launch Acceleration"},{"1":"S05E24","2":"The Countdown Reflection"},{"1":"S06E01","2":"The Date Night Variable"},{"1":"S06E02","2":"The Decoupling Fluctuation"},{"1":"S06E03","2":"The Higgs Boson Observation"},{"1":"S06E04","2":"The Re-Entry Minimization"},{"1":"S06E05","2":"The Holographic Excitation"},{"1":"S06E06","2":"The Extract Obliteration"},{"1":"S06E07","2":"The Habitation Configuration"},{"1":"S06E08","2":"The 43 Peculiarity"},{"1":"S06E09","2":"The Parking Spot Escalation"},{"1":"S06E10","2":"The Fish Guts Displacement"},{"1":"S06E11","2":"The Santa Simulation"},{"1":"S06E12","2":"The Egg Salad Equivalency"},{"1":"S06E13","2":"The Bakersfield Expedition"},{"1":"S06E14","2":"The Cooper/Kripke Inversion"},{"1":"S06E15","2":"The Spoiler Alert Segmentation"},{"1":"S06E16","2":"The Tangible Affection Proof"},{"1":"S06E17","2":"The Monster Isolation"},{"1":"S06E18","2":"The Contractual Obligation Implementation"},{"1":"S06E19","2":"The Closet Reconfiguration"},{"1":"S06E20","2":"The Tenure Turbulence"},{"1":"S06E21","2":"The Closure Alternative"},{"1":"S06E22","2":"The Proton Resurgence"},{"1":"S06E23","2":"The Love Spell Potential"},{"1":"S06E24","2":"The Bon Voyage Reaction"},{"1":"S07E01","2":"The Hofstadter Insufficiency"},{"1":"S07E02","2":"The Deception Verification"},{"1":"S07E03","2":"The Scavenger Vortex"},{"1":"S07E04","2":"The Raiders Minimization"},{"1":"S07E05","2":"The Workplace Proximity"},{"1":"S07E06","2":"The Romance Resonance"},{"1":"S07E07","2":"The Proton Displacement"},{"1":"S07E08","2":"The Itchy Brain Simulation"},{"1":"S07E09","2":"The Thanksgiving Decoupling"},{"1":"S07E10","2":"The Discovery Dissipation"},{"1":"S07E11","2":"The Cooper Extraction"},{"1":"S07E12","2":"The Hesitation Ramification"},{"1":"S07E13","2":"The Occupation Recalibration"},{"1":"S07E14","2":"The Convention Conundrum"},{"1":"S07E15","2":"The Locomotive Manipulation"},{"1":"S07E16","2":"The Table Polarization"},{"1":"S07E17","2":"The Friendship Turbulence"},{"1":"S07E18","2":"The Mommy Observation"},{"1":"S07E19","2":"The Indecision Amalgamation"},{"1":"S07E20","2":"The Relationship Diremption"},{"1":"S07E21","2":"The Anything Can Happen Recurrence"},{"1":"S07E22","2":"The Proton Transmogrification"},{"1":"S07E23","2":"The Gorilla Dissolution"},{"1":"S07E24","2":"The Status Quo Combustion"},{"1":"S08E01","2":"The Locomotion Interruption"},{"1":"S08E02","2":"The Junior Professor Solution"},{"1":"S08E03","2":"The First Pitch Insufficiency"},{"1":"S08E04","2":"The Hook-Up Reverberation"},{"1":"S08E05","2":"The Focus Attenuation"},{"1":"S08E06","2":"The Expedition Approximation"},{"1":"S08E07","2":"The Misinterpretation Agitation"},{"1":"S08E08","2":"The Prom Equivalency"},{"1":"S08E09","2":"The Septum Deviation"},{"1":"S08E10","2":"The Champagne Reflection"},{"1":"S08E11","2":"The Clean Room Infiltration"},{"1":"S08E12","2":"The Space Probe Disintegration"},{"1":"S08E13","2":"The Anxiety Optimization"},{"1":"S08E14","2":"The Troll Manifestation"},{"1":"S08E15","2":"The Comic Book Store Regeneration"},{"1":"S08E16","2":"The Intimacy Acceleration"},{"1":"S08E17","2":"The Colonization Application"},{"1":"S08E18","2":"The Leftover Thermalization"},{"1":"S08E19","2":"The Skywalker Incursion"},{"1":"S08E20","2":"The Fortification Implementation"},{"1":"S08E21","2":"The Communication Deterioration"},{"1":"S08E22","2":"The Graduation Transmission"},{"1":"S08E23","2":"The Maternal Combustion"},{"1":"S08E24","2":"The Commitment Determination"},{"1":"S09E01","2":"The Matrimonial Momentum"},{"1":"S09E02","2":"The Separation Oscillation"},{"1":"S09E03","2":"The Bachelor Party Corrosion"},{"1":"S09E04","2":"The 2003 Approximation"},{"1":"S09E05","2":"The Perspiration Implementation"},{"1":"S09E06","2":"The Helium Insufficiency"},{"1":"S09E07","2":"The Spock Resonance"},{"1":"S09E08","2":"The Mystery Date Observation"},{"1":"S09E09","2":"The Platonic Permutation"},{"1":"S09E10","2":"The Earworm Reverberation"},{"1":"S09E11","2":"The Opening Night Excitation"},{"1":"S09E12","2":"The Sales Call Sublimation"},{"1":"S09E13","2":"The Empathy Optimization"},{"1":"S09E14","2":"The Meemaw Materialization"},{"1":"S09E15","2":"The Valentino Submergence"},{"1":"S09E16","2":"The Positive Negative Reaction"},{"1":"S09E17","2":"The Celebration Experimentation"},{"1":"S09E18","2":"The Application Deterioration"},{"1":"S09E19","2":"The Solder Excursion Diversion"},{"1":"S09E20","2":"The Big Bear Precipitation"},{"1":"S09E21","2":"The Viewing Party Combustion"},{"1":"S09E22","2":"The Fermentation Bifurcation"},{"1":"S09E23","2":"The Line Substitution Solution"},{"1":"S09E24","2":"The Convergence Convergence"},{"1":"S10E01","2":"The Conjugal Conjecture"},{"1":"S10E02","2":"The Military Miniaturization"},{"1":"S10E03","2":"The Dependence Transcendence"},{"1":"S10E04","2":"The Cohabitation Experimentation"},{"1":"S10E05","2":"The Hot Tub Contamination"},{"1":"S10E06","2":"The Fetal Kick Catalyst"},{"1":"S10E07","2":"The Veracity Elasticity"},{"1":"S10E08","2":"The Brain Bowl Incubation"},{"1":"S10E09","2":"The Geology Elevation"},{"1":"S10E10","2":"The Property Division Collision"},{"1":"S10E11","2":"The Birthday Synchronicity"},{"1":"S10E12","2":"The Holiday Summation"},{"1":"S10E13","2":"The Romance Recalibration"},{"1":"S10E14","2":"The Emotion Detection Automation"},{"1":"S10E15","2":"The Locomotion Reverberation"},{"1":"S10E16","2":"The Allowance Evaporation"},{"1":"S10E17","2":"The Comic-Con Conundrum"},{"1":"S10E18","2":"The Escape Hatch Identification"},{"1":"S10E19","2":"The Collaboration Fluctuation"},{"1":"S10E20","2":"The Recollection Dissipation"},{"1":"S10E21","2":"The Separation Agitation"},{"1":"S10E22","2":"The Cognition Regeneration"},{"1":"S10E23","2":"The Gyroscopic Collapse"},{"1":"S10E24","2":"The Long Distance Dissonance"},{"1":"S11E01","2":"The Proposal Proposal"},{"1":"S11E02","2":"The Retraction Reaction"},{"1":"S11E03","2":"The Relaxation Integration"},{"1":"S11E04","2":"The Explosion Implosion"},{"1":"S11E05","2":"The Collaboration Contamination"},{"1":"S11E06","2":"The Proton Regeneration"},{"1":"S11E07","2":"The Geology Methodology"},{"1":"S11E08","2":"The Tesla Recoil"},{"1":"S11E09","2":"The Bitcoin Entanglement"},{"1":"S11E10","2":"The Confidence Erosion"},{"1":"S11E11","2":"The Celebration Reverberation"},{"1":"S11E12","2":"The Matrimonial Metric"},{"1":"S11E13","2":"The Solo Oscillation"},{"1":"S11E14","2":"The Separation Triangulation"},{"1":"S11E15","2":"The Novelization Correlation"},{"1":"S11E16","2":"The Neonatal Nomenclature"},{"1":"S11E17","2":"The Athenaeum Allocation"},{"1":"S11E18","2":"The Gates Excitation"},{"1":"S11E19","2":"The Tenant Disassociation"},{"1":"S11E20","2":"The Reclusive Potential"},{"1":"S11E21","2":"The Comet Polarization"},{"1":"S11E22","2":"The Monetary Insufficiency"},{"1":"S11E23","2":"The Sibling Realignment"},{"1":"S11E24","2":"The Bow Tie Asymmetry"},{"1":"S12E01","2":"The Conjugal Configuration"},{"1":"S12E02","2":"The Wedding Gift Wormhole"},{"1":"S12E03","2":"The Procreation Calculation"},{"1":"S12E04","2":"The Tam Turbulence"},{"1":"S12E05","2":"The Planetarium Collision"},{"1":"S12E06","2":"The Imitation Perturbation"},{"1":"S12E07","2":"The Grant Allocation Derivation"},{"1":"S12E08","2":"The Consummation Deviation"},{"1":"S12E09","2":"The Citation Negation"},{"1":"S12E10","2":"The VCR Illumination"},{"1":"S12E11","2":"The Paintball Scattering"},{"1":"S12E12","2":"The Propagation Proposition"},{"1":"S12E13","2":"The Confirmation Polarization"},{"1":"S12E14","2":"The Meteorite Manifestation"},{"1":"S12E15","2":"The Donation Oscillation"},{"1":"S12E16","2":"The D&D Vortex"},{"1":"S12E17","2":"The Conference Valuation"},{"1":"S12E18","2":"The Laureate Accumulation"},{"1":"S12E19","2":"The Inspiration Deprivation"},{"1":"S12E20","2":"The Decision Reverberation"},{"1":"S12E21","2":"The Plagiarism Schism"},{"1":"S12E22","2":"The Maternal Conclusion"},{"1":"S12E23","2":"The Change Constant"},{"1":"S12E24","2":"The Stockholm Syndrome"},{"1":"S12E25","2":"Unraveling the Mystery: A Big Bang Farewell"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание
</div>
</div>
<div class="callout-body-container callout-body">
<p>Самостоятельно создайте тиббл, в котором будет храниться количество серий для каждого сезона.</p>
</div>
</div>
<p>Еще один способ описан <a href="https://tidyr.tidyverse.org/articles/rectangle.html">здесь</a>.</p>
</section>
<section id="датасет-шедевры-пушкинского-музея" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="датасет-шедевры-пушкинского-музея"><span class="header-section-number">5.1.3</span> Датасет: Шедевры Пушкинского музея</h3>
<p>JSON – популярный формат для публикации открытых данных. В таком виде часто публикуют данные органы государственной власти, культурные и некоммерческие организации и др. Например, <a href="https://pushkinmuseum.art/open_data/">Пушкинский музей</a>.</p>
<p>Взглянем на датасет “Шедевры из коллекции музея”. JSON можно прочитать напрямую из Сети.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_json</span>(<span class="st">"https://pushkinmuseum.art/json/masterpieces.json"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Датасет содержит информацию о 97 единицах хранения.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(doc)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "3687"  "3675"  "3706"  "3708"  "3713"  "3716"  "4005"  "4011"  "4014" 
[10] "4023"  "4030"  "4131"  "4147"  "4149"  "4161"  "4163"  "4178"  "4180" 
[19] "4191"  "4193"  "4198"  "4209"  "4244"  "4255"  "4260"  "4262"  "4266" 
[28] "4291"  "4325"  "4338"  "4350"  "4421"  "4450"  "4518"  "4543"  "4641" 
[37] "4711"  "4724"  "4767"  "7563"  "4782"  "4783"  "4788"  "4844"  "4906" 
[46] "4932"  "4936"  "4941"  "4949"  "4950"  "5238"  "5239"  "5297"  "5347" 
[55] "5591"  "5798"  "5910"  "5913"  "5992"  "6187"  "6226"  "6564"  "6584" 
[64] "6586"  "6629"  "6632"  "6886"  "7034"  "7151"  "7457"  "7468"  "7564" 
[73] "7565"  "7566"  "7567"  "7568"  "7569"  "7570"  "9464"  "9415"  "9046" 
[82] "10253" "10284" "10266" "10277" "10282" "10278" "10279" "10280" "10281"
[91] "10285" "10286" "10287" "10288" "10289" "10290" "10291"</code></pre>
</div>
</div>
<p>Для каждого предмета дано подробное описание.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(doc[[<span class="dv">1</span>]])</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Length Class  Mode     
path               1      -none- character
m_parent_id        1      -none- character
year               1      -none- numeric  
get_year           1      -none- character
inv_num            1      -none- character
type               2      -none- list     
country            2      -none- list     
period             2      -none- list     
paint_school       1      -none- character
graphics_type      1      -none- character
department         1      -none- character
masterpiece        1      -none- character
show_in_hall       1      -none- character
show_in_collection 1      -none- numeric  
name               2      -none- list     
namecom            2      -none- list     
size               2      -none- list     
text               2      -none- list     
annotation         2      -none- list     
litra              2      -none- list     
restor             2      -none- list     
audioguide         2      -none- list     
videoguide         2      -none- list     
link               2      -none- list     
linktext           2      -none- list     
producein          2      -none- list     
material           2      -none- list     
from               2      -none- list     
matvos             2      -none- list     
sizevos            2      -none- list     
prodcast           2      -none- list     
searcha            2      -none- list     
seakeys            2      -none- list     
hall               1      -none- character
building           1      -none- character
gallery            1      -none- list     
authors            1      -none- character
collectors         1      -none- list     
cast               1      -none- character
shop               1      -none- character</code></pre>
</div>
</div>
<p>Заберем только то, что нам интересно.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>masterpieces <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">map_chr</span>(doc, pluck, <span class="st">"name"</span>, <span class="st">"ru"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">get_year =</span> <span class="fu">map_chr</span>(doc, pluck, <span class="st">"get_year"</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">map_int</span>(doc, pluck, <span class="st">"year"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="fu">map_chr</span>(doc, pluck, <span class="st">"period"</span>, <span class="st">"name"</span>, <span class="st">"ru"</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">map_chr</span>(doc, pluck, <span class="st">"country"</span>, <span class="st">"ru"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gallery =</span> <span class="fu">paste0</span>(<span class="st">"https://pushkinmuseum.art"</span>, <span class="fu">map_chr</span>(doc, pluck, <span class="st">"gallery"</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Библиотека <code>imager</code> позволяет работать с изображениями из датасета. Вот так мы могли бы забрать одно из них.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imager)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>img <span class="ot">&lt;-</span> <span class="fu">load.image</span>(masterpieces<span class="sc">$</span>gallery[<span class="dv">1</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>img</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/pushkin1.png" class="img-fluid"></p>
<p>В пакете <code>imager</code> есть функция <code>map_il()</code>, которая похожа на свою родню из <code>purrr</code>, но возвращает список изображений.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>img_gallery <span class="ot">&lt;-</span> <span class="fu">map_il</span>(gallery, <span class="sc">~</span><span class="fu">load.image</span>(.x))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Функция <code>walk()</code> из пакета <code>purrr</code> – это аналог <code>map()</code> для тех случаев, когда нас интересует только вывод, т.е.не надо ничего сохранять в окружение.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(img_gallery, plot, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/pushkin2.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание
</div>
</div>
<div class="callout-body-container callout-body">
<p>Попробуйте самостоятельно узнать, когда приобретена большая часть шедевров и из каких регионов они происходят.</p>
</div>
</div>
</section>
</section>
<section id="xml" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="xml"><span class="header-section-number">5.2</span> XML</h2>
<p>XML (от англ. eXtensible Markup Language) — расширяемый язык разметки. Слово “расширяемый” означает, что список тегов не зафиксирован раз и навсегда: пользователи могут вводить свои собственные теги и создавать так называемые <em>настраиваемые языки разметки</em> <span class="citation" data-cites="xml2004">(<a href="references.html#ref-xml2004" role="doc-biblioref">Холзнер 2004, 29</a>)</span>. Один из таких настраиваемых языков – это TEI (Text Encoding Initiative), о котором будет сказано дальше.</p>
<p>Назначение языков разметки заключается в описании структурированных документов. Структура документа представляется в виде набора вложенных в друг друга элементов (дерева XML). У элементов есть открывающие и закрывающие теги.</p>
<p>Все составляющие части документа обобщаются в пролог и корневой элемент. Корневой элемент — обязательная часть документа, в которую вложены все остальные элементы. Пролог может включать объявления, инструкции обработки, комментарии.</p>
<p>В правильно сформированном XML открывающий и закрывающий тег вложенного элемента всегда находятся внутри одного родительского элемента.</p>
<p>Создадим простой XML из строки. Сначала идет инструкция по обработке XML (со знаком вопроса), за ней следует объявление типа документа (с восклицательным знаком) и открывающий тег корневого элемента. В этот корневой элемент вложены все остальные элементы.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>string_xml <span class="ot">&lt;-</span> <span class="st">'&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;!DOCTYPE recipe&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;recipe name="хлеб" preptime="5min" cooktime="180min"&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;title&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">      Простой хлеб</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;/title&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;composition&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;ingredient amount="0.25" unit="грамм"&gt;Дрожжи&lt;/ingredient&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;/composition&gt;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;instructions&gt;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="st">     &lt;step&gt;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="st">        Смешать все ингредиенты и тщательно замесить. </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="st">     &lt;/step&gt;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="st">     &lt;step&gt;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="st">        Закрыть тканью и оставить на один час в тёплом помещении. </span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="st">     &lt;/step&gt;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="st">     &lt;step&gt;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="st">        Замесить ещё раз, положить на противень и поставить в духовку.</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="st">     &lt;/step&gt;</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="st">   &lt;/instructions&gt;</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/recipe&gt;'</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="библиотека-xml" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="библиотека-xml"><span class="header-section-number">5.2.1</span> Библиотека <code>XML</code></h3>
<p>Для работы с xml понадобится установить одноименную библиотеку. Функция <code>xmlTreeParse()</code> создаст R-структуру, представляющую дерево XML.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(XML)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">xmlTreeParse</span>(string_xml)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(doc)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "XMLDocument"         "XMLAbstractDocument"</code></pre>
</div>
</div>
<p>Функция <code>xmlRoot()</code> позволяет извлечь корневой элемент вместе со всеми детьми.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rootnode <span class="ot">&lt;-</span> <span class="fu">xmlRoot</span>(doc)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rootnode</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;recipe name="хлеб" preptime="5min" cooktime="180min"&gt;
 &lt;title&gt;Простой хлеб&lt;/title&gt;
 &lt;composition&gt;
  &lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;
  &lt;ingredient amount="0.25" unit="грамм"&gt;Дрожжи&lt;/ingredient&gt;
  &lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;
 &lt;/composition&gt;
 &lt;instructions&gt;
  &lt;step&gt;Смешать все ингредиенты и тщательно замесить.&lt;/step&gt;
  &lt;step&gt;Закрыть тканью и оставить на один час в тёплом помещении.&lt;/step&gt;
  &lt;step&gt;Замесить ещё раз, положить на противень и поставить в духовку.&lt;/step&gt;
 &lt;/instructions&gt;
&lt;/recipe&gt;</code></pre>
</div>
</div>
<p>Если документ большой, бывает удобнее не распечатывать все дерево, а вывести имена дочерних элементов.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">xmlChildren</span>(rootnode))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "title"        "composition"  "instructions"</code></pre>
</div>
</div>
<p>Размер узла – это число вложенных в него “детей”. Его можно узнать, применив к узлу функцию <code>xmlSize()</code> – или посчитав число “детей”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlSize</span>(rootnode) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">xmlChildren</span>(rootnode))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="выбор-элементов" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="выбор-элементов"><span class="header-section-number">5.2.2</span> Выбор элементов</h3>
<p>Работать с xml можно как с обычным списком, то есть индексировать узлы по имени или по номеру элемента при помощи квадратных скобок. Так мы достаем узел по имени:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rootnode[[<span class="st">"composition"</span>]]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;composition&gt;
 &lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;
 &lt;ingredient amount="0.25" unit="грамм"&gt;Дрожжи&lt;/ingredient&gt;
 &lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;
&lt;/composition&gt;</code></pre>
</div>
</div>
<p>А так – по индексу:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rootnode[[<span class="dv">2</span>]]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;composition&gt;
 &lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;
 &lt;ingredient amount="0.25" unit="грамм"&gt;Дрожжи&lt;/ingredient&gt;
 &lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;
&lt;/composition&gt;</code></pre>
</div>
</div>
<p>Как и с обычными списками, мы можем использовать последовательности квадратных скобок:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ingr_node <span class="ot">&lt;-</span> rootnode[[<span class="dv">2</span>]][[<span class="st">"ingredient"</span>]]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ingr_node</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;</code></pre>
</div>
</div>
</section>
<section id="значения-узлов-и-атрибутов" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="значения-узлов-и-атрибутов"><span class="header-section-number">5.2.3</span> Значения узлов и атрибутов</h3>
<p>Но обычно нам нужен не элемент как таковой, а его содержание (значение). Чтобы добраться до него, используем функцию <code>xmlValue()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlValue</span>(ingr_node)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Мука"</code></pre>
</div>
</div>
<p>Можно уточнить атрибуты узла при помощи <code>xmlAttrs()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlAttrs</span>(ingr_node)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  amount     unit 
     "3" "стакан" </code></pre>
</div>
</div>
<p>Чтобы извлечь значение атрибута, используем функцию <code>xmlGetAttr()</code>. Первым аргументом функции передаем xml-узел, вторым – имя атрибута.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlGetAttr</span>(ingr_node, <span class="st">"unit"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "стакан"</code></pre>
</div>
</div>
</section>
<section id="обход-дерева-узлов" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="обход-дерева-узлов"><span class="header-section-number">5.2.4</span> Обход дерева узлов</h3>
<p>Как насчет того, чтобы применить функцию к набору узлов – например, ко всем инредиентам? Вспоминаем функции для работы со списками – <code>sapply()</code> из базового R или <code>map()</code> из пакета <code>purrr</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ingr_nodes <span class="ot">&lt;-</span> <span class="fu">xmlChildren</span>(rootnode[[<span class="dv">2</span>]])</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(ingr_nodes, xmlValue)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ingredient    ingredient    ingredient 
       "Мука"      "Дрожжи" "Тёплая вода" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(ingr_nodes, xmlGetAttr, <span class="st">"unit"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ingredient ingredient ingredient 
  "стакан"    "грамм"   "стакан" </code></pre>
</div>
</div>
</section>
<section id="синтаксис-xpath" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="синтаксис-xpath"><span class="header-section-number">5.2.5</span> Синтаксис XPath</h3>
<p>Добраться до узлов определенного уровня можно также при помощи синтаксиса <a href="https://ru.wikipedia.org/wiki/XPath">XPath</a>. XPath – это язык запросов к элементам XML-документа. С его помощью можно описать “путь” до нужного узла: <strong>абсолютный</strong> (начиная с корневого элемента) или <strong>относительный</strong>. В пакете <code>XML</code> синтаксис XPath поддерживает функция <code>getNodeSet()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># абсолютный путь</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ingr_nodes <span class="ot">&lt;-</span> <span class="fu">getNodeSet</span>(rootnode, <span class="st">"/recipe//composition//ingredient"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>ingr_nodes</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
&lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;

[[2]]
&lt;ingredient amount="0.25" unit="грамм"&gt;Дрожжи&lt;/ingredient&gt;

[[3]]
&lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># относительный путь</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>ingr_nodes <span class="ot">&lt;-</span> <span class="fu">getNodeSet</span>(rootnode, <span class="st">"//composition//ingredient"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>ingr_nodes</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
&lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;

[[2]]
&lt;ingredient amount="0.25" unit="грамм"&gt;Дрожжи&lt;/ingredient&gt;

[[3]]
&lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;</code></pre>
</div>
</div>
<p><br></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
На заметку
</div>
</div>
<div class="callout-body-container callout-body">
<p>В большинстве случаев функция <code>getNodeSet()</code> требует задать <strong>пространство имен</strong> (namespace), но в нашем случае оно не определено, поэтому пока передаем только дерево и путь до узла. С пространством имен встретимся чуть позже!</p>
</div>
</div>
<p><br></p>
<p>Синтаксис XPath позволяет отбирать узлы с определенными атрибутами. Допустим, нам нужны только те узлы, где значение атрибута unit = “стакан”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getNodeSet</span>(rootnode, <span class="st">"//composition//ingredient[@unit='стакан']"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
&lt;ingredient amount="3" unit="стакан"&gt;Мука&lt;/ingredient&gt;

[[2]]
&lt;ingredient amount="1.5" unit="стакан"&gt;Тёплая вода&lt;/ingredient&gt;</code></pre>
</div>
</div>
</section>
<section id="от-дерева-к-таблице" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="от-дерева-к-таблице"><span class="header-section-number">5.2.6</span> От дерева к таблице</h3>
<p>При работе с xml в большинстве случаев наша задача – извлечь значения определеннных узлов или их атрибутов и сохранить их в прямоугольном формате. Один из способов выглядит так.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">title =</span> <span class="fu">xmlValue</span>(rootnode[[<span class="st">"title"</span>]]), </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">ingredients =</span> <span class="fu">map_chr</span>(<span class="fu">xmlChildren</span>(rootnode[[<span class="st">"composition"</span>]]), xmlValue),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">unit =</span> <span class="fu">map_chr</span>(<span class="fu">xmlChildren</span>(rootnode[[<span class="st">"composition"</span>]]), xmlGetAttr, <span class="st">"unit"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">amount =</span> <span class="fu">map_chr</span>(<span class="fu">xmlChildren</span>(rootnode[[<span class="st">"composition"</span>]]), xmlGetAttr, <span class="st">"amount"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["title"],"name":[1],"type":["chr"],"align":["left"]},{"label":["ingredients"],"name":[2],"type":["chr"],"align":["left"]},{"label":["unit"],"name":[3],"type":["chr"],"align":["left"]},{"label":["amount"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Простой хлеб","2":"Мука","3":"стакан","4":"3"},{"1":"Простой хлеб","2":"Дрожжи","3":"грамм","4":"0.25"},{"1":"Простой хлеб","2":"Тёплая вода","3":"стакан","4":"1.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="разметка-tei" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="разметка-tei"><span class="header-section-number">5.2.7</span> Разметка TEI</h3>
<p>Большая часть размеченных литературных корпусов хранится именно в формате XML. Это очень удобно, и вот почему: документы в формате XML, как и документы в формате HTML, содержат данные, заключенные в теги, но если в формате HTML теги определяют оформление данных, то в формате XML теги нередко определяют структуру и смысл данных. С их помощью мы можем достать из документа именно то, что нам интересно: определенную главу, речи конкретных персонажей, слова на иностранных языках и т.п.</p>
<p>Добавлять и удалять разметку может любой пользователь в редакторе XML кода или даже в простом текстовом редакторе. При этом в качестве универсального языка разметки в гуманитарных дисциплинах используется язык TEI <span class="citation" data-cites="skorinkin2016">(<a href="references.html#ref-skorinkin2016" role="doc-biblioref">Скоринкин 2016</a>)</span>. Корневой элемент в документах TEI называется TEI, внутри него располагается элемент teiHeader с метаинформацией о документе и элемент text. Последний содержит текст документа с элементами, определяющими его структурное членение.</p>
<pre><code>&lt;TEI&gt;
  &lt;teiHeader&gt;&lt;/teiHeader&gt;
  &lt;text&gt;&lt;/text&gt;
&lt;/TEI&gt;</code></pre>
<p>Пример оформления документа можно посмотреть <a href="https://github.com/dracor-org/rusdracor/blob/main/tei/fonvizin-nedorosl.xml">по ссылке</a>.</p>
<p>У teiHeader есть четыре главных дочерних элемента:</p>
<ul>
<li><code>fileDesc</code> (описание документа c библиографической информацией)</li>
<li><code>encodingDesc</code> (описание способа кодирование первоисточника)</li>
<li><code>profileDesc</code> (“досье” на текст, например отправитель и получатель для писем, жанр, используемые языки, обстоятельства создания, место написания и т.п.)</li>
<li><code>revisionDesc</code> (история изменений документа).</li>
</ul>
<p>В самом тексте язык TEI дает возможность представлять разные варианты (авторские, редакторские, корректорские и др.) Основным средством параллельного представления является элемент <code>choice</code>. Например, в <a href="https://github.com/PerseusDL/canonical-latinLit/blob/master/data/phi0550/phi001/phi0550.phi001.perseus-lat1.xml">тексте Лукреция</a> вы можете увидеть такое:</p>
<pre><code>sic calor atque &lt;choice&gt;&lt;reg&gt;aer&lt;/reg&gt;&lt;orig&gt;aër&lt;/orig&gt;&lt;/choice&gt; et venti caeca potestas</code></pre>
<p>Здесь reg указывает на нормализованное написание, а orig – на оригинальное.</p>
</section>
<section id="датасет-война-и-мир" class="level3" data-number="5.2.8">
<h3 data-number="5.2.8" class="anchored" data-anchor-id="датасет-война-и-мир"><span class="header-section-number">5.2.8</span> Датасет: “Война и мир”</h3>
<p>В качестве примера загрузим датасет “Пушкинского дома”, подготовленный Д.А. Скоринкиным: <a href="https://dataverse.pushdom.ru/dataset.xhtml?persistentId=doi:10.31860/openlit-2022.1-C005">“Персонажи «Войны и мира» Л. Н. Толстого: вхождения в тексте, прямая речь и семантические роли”</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">=</span> <span class="st">"../files/War_and_Peace.xml"</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">xmlTreeParse</span>(filename, <span class="at">useInternalNodes =</span> T)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>rootnode <span class="ot">&lt;-</span> <span class="fu">xmlRoot</span>(doc)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Теперь можно внимательнее взглянуть на структуру xml. Корневой элемент расходится на две ветви. Полностью они нам пока не нужны, узнаем только имена:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">xmlChildren</span>(rootnode)) </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "teiHeader" "text"     </code></pre>
</div>
</div>
<p>Очевидно, что что-то для нас интересное будет спрятано в ветке text, глядим на нее:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">xmlChildren</span>(rootnode[[<span class="st">"text"</span>]])) </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "div" "div" "div" "div" "div"</code></pre>
</div>
</div>
<p>Итак, текст делится на какие-то пять частей. Функция <code>xmlGetAttr()</code> позволяет узнать значение атрибута <code>type</code>: как выясняется, это четыре тома и эпилог.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># это список</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>divs <span class="ot">&lt;-</span>  rootnode[[<span class="st">"text"</span>]][<span class="st">"div"</span>]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(divs, xmlGetAttr, <span class="st">"type"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       div        div        div        div        div 
  "volume"   "volume"   "volume"   "volume" "epilogue" </code></pre>
</div>
</div>
<p>Как мы уже знаем, добраться до определенного узла можно не только путем индексирования, но и – гораздо удобнее – при помощи синтаксиса XPath. Для этого просто указываем путь до узла. Попробуем спуститься на два уровня ниже: там тоже будет тег div, но с другим атрибутом. Как легко убедиться, теперь это главы, всего их 358.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>divs <span class="ot">&lt;-</span> <span class="fu">getNodeSet</span>(doc, <span class="st">"/tei:TEI//tei:text//tei:div//tei:div//tei:div"</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">namespaces =</span> <span class="fu">c</span>(<span class="at">tei =</span> <span class="st">"http://www.tei-c.org/ns/1.0"</span>)) </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(divs)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 358</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sapply</span>(divs, xmlGetAttr, <span class="st">"type"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "chapter"</code></pre>
</div>
</div>
<p>Обратите внимание, что в данном случае надо прямо прописать пространство имен (namespaces). Это можно посмотреть в самом xml, а можно воспользоваться специальной функцией:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlNamespace</span>(rootnode)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "http://www.tei-c.org/ns/1.0"
attr(,"class")
[1] "XMLNamespace"</code></pre>
</div>
</div>
<p>Забрать конкретную главу можно путем индексации, но лучше – по значению соответствующего атрибута.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">map</span>(divs, xmlGetAttr, <span class="st">"xml:id"</span>) <span class="sc">==</span> <span class="st">"chapter1part1Volume1"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>ch1 <span class="ot">&lt;-</span> divs[[idx]]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Чтобы извлечь текст, понадобится функция <code>xmlValue</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>chapter_1 <span class="ot">&lt;-</span> <span class="fu">xmlValue</span>(ch1)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Распечатывать весь текст первой главы не будем (это очень длинный вектор); разобъем текст на параграфы и выведем первый и последний:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>chapter_lines <span class="ot">&lt;-</span> <span class="fu">str_split</span>(chapter_1, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>chapter_lines[[<span class="dv">1</span>]][[<span class="dv">5</span>]]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "        — Eh bien, mon prince. Gênes et Lueques ne sont plus que des apanages, des поместья, de la famille Buonaparte. Non, je vous préviens que si vous ne me dites pas que nous avons la guerre, si vous vous permettez encore de pallier toutes les infamies, toutes les atrocités de cet Antichrist (ma parole, j'y crois) — je ne vous connais plus, vous n'êtes plus mon ami, vous n'êtes plus мой верный раб, comme vous dites. Ну, здравствуйте, здравствуйте. Je vois que je vous fais peur, садитесь и рассказывайте."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>chapter_lines[[<span class="dv">1</span>]][[<span class="dv">838</span>]]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "       Ce sera dans votre famille que je ferai mon apprentissage de vieille fille."</code></pre>
</div>
</div>
<p>Первая и последняя реплика по-французски: все правильно!</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание
</div>
</div>
<div class="callout-body-container callout-body">
<p>Скачайте по <a href="https://raw.githubusercontent.com/dracor-org/rusdracor/main/tei/griboyedov-gore-ot-uma.xml">ссылке</a> “Горе от ума” Грибоедова и преобразуйте xml в прямоугольный формат таким образом, чтобы для каждой реплики был указан акт, сцена и действующее лицо.</p>
</div>
</div>
<p>Подбробнее о структуре XML документов и способах работы с ними вы можете прочитать в книгах: <span class="citation" data-cites="nolan2014">(<a href="references.html#ref-nolan2014" role="doc-biblioref">Nolan и Lang 2014</a>)</span> и <span class="citation" data-cites="xml2004">(<a href="references.html#ref-xml2004" role="doc-biblioref">Холзнер 2004</a>)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-nolan2014" class="csl-entry" role="listitem">
Nolan, D., и D. T. Lang. 2014. <em>XML and Web Technologies for Data Science with R</em>. Springer.
</div>
<div id="ref-skorinkin2016" class="csl-entry" role="listitem">
Скоринкин, Даниил. 2016. <span>«Электронное представление текста с помощью стандарта разметки TEI»</span>, 90–108.
</div>
<div id="ref-xml2004" class="csl-entry" role="listitem">
Холзнер, Стивен. 2004. <em><span>Энциклопедия XML</span></em>. Питер.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./iterate.html" class="pagination-link" aria-label="Циклы, условия, функции">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Циклы, условия, функции</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./share.html" class="pagination-link" aria-label="Публикационная система Quarto">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Публикационная система Quarto</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>