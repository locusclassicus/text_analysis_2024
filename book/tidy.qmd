# –û–ø—Ä—è—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

> Tidy datasets are all alike, but every messy dataset is messy in its own way.
>
> --- Hadley Wickham

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å tidyverse

–°—É—â–µ—Å—Ç–≤—É—é—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö "–¥–∏–∞–ª–µ–∫—Ç–∞" R, –æ–¥–∏–Ω –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–∏—Ä–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –±–∞–∑–æ–≤–æ–≥–æ R, –∞ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º tidyverse [@winter2020]. Tidyverse -- —ç—Ç–æ —Å–µ–º–µ–π—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤ (**–º–µ—Ç–∞–ø–∞–∫–µ—Ç**), —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –•–∞–¥–ª–∏ –£–∏–∫—Ö–µ–º–æ–º –∏ –¥—Ä., –∫–æ—Ç–æ—Ä–æ–µ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤ —Ç–æ–º —á–∏—Å–ª–µ –ø–∞–∫–µ—Ç—ã `dplyr`, `ggplot2` –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ.

```{r}
# –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–µ–º–µ–π—Å—Ç–≤–æ
library(tidyverse)
```

### Tibble

–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ tidyverse -- —ç—Ç–æ tibble, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞[^03-tidy-1]. –¢–∏–±–±–ª, –∫–∞–∫ –≥–æ–≤–æ—Ä—è—Ç –µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏, —ç—Ç–æ –ª–µ–Ω–∏–≤—ã–µ –∏ –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–µ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º—ã: –æ–Ω–∏ –¥–µ–ª–∞—é—Ç –º–µ–Ω—å—à–µ –∏ –∂–∞–ª—É—é—Ç—Å—è –±–æ–ª—å—à–µ[^03-tidy-2]. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö, —á—Ç–æ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å–æ–∑–¥–∞–Ω–∏—é –±–æ–ª–µ–µ —á–∏—Å—Ç–æ–≥–æ –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞.

[^03-tidy-1]: <https://r4ds.had.co.nz/tibbles.html>

[^03-tidy-2]: <https://tibble.tidyverse.org/>

–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞:

-   —Ç–µ–∫—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∏, –∞ –Ω–µ –≤ —Ñ–∞–∫—Ç–æ—Ä—ã;^[–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–º, –ø–æ—á–µ–º—É —Ç–∞–∫ –≤–æ–æ–±—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: https://simplystatistics.org/posts/2015-07-24-stringsasfactors-an-unauthorized-biography/]
-   —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `print()`, –Ω–µ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `head()`;
-   –Ω–µ—Ç –∏–º–µ–Ω —Ä—è–¥–æ–≤;
-   –¥–æ–ø—É—Å–∫–∞–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ" –∏–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤;
-   –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–µ –º–µ–Ω—è–µ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤–µ–∫—Ç–æ—Ä –∏ –¥—Ä.

```{r}
load("../data/diorisis_meta.Rdata")

# —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —Ä—è–¥–æ–≤, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ —É–∫–∞–∑–∞–Ω —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö, —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω—ã
as_tibble(diorisis_meta)

# –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ 
head(as.data.frame(diorisis_meta)[, 1])  # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä
as_tibble(diorisis_meta)[,1] # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–±–±–ª

# –∏–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤
df <- data.frame('var 1' = 1:2, two = 3:4)
df
tbl <- tibble('var 1' = 1:2, two = 3:4)
tbl
```

–ü–æ—Ä–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è.

::::{.callout-warning icon=false}
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫—É—Ä—Å `swirl::install_course("Getting and Cleaning Data")`.  –ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `library(swirl)`, –∑–∞–ø—É—Å—Ç–∏—Ç–µ `swirl()`, –≤—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–æ—Ç –∫—É—Ä—Å –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∏–∑ –Ω–µ–≥–æ —É—Ä–æ–∫ 1 `Manipulating Data with dplyr`.
::::

</br>

::::{.callout-note icon=false}
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Ä–æ–∫ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: `/Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library/swirl/Courses/Getting_and_Cleaning_Data/Manipulating_Data_with_dplyr/lesson.yaml) Scanner error: while scanning a tag at line 205, column 9 did not find expected whitespace or line break at line 205, column 19`. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—É—Ç—å –¥–æ –ø–∞–ø–∫–∏ —Å –∫—É—Ä—Å–æ–º. –ù–∞ MacOS –æ—Ç–∫—Ä–æ–π—Ç–µ Finder `>` Go `>` Go to Folder. –í—Å—Ç–∞–≤—å—Ç–µ –ø—É—Ç—å –¥–æ –ø–∞–ø–∫–∏ –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–µ—Å—è –æ–∫–Ω–æ, –Ω–∞–π–¥–∏—Ç–µ —Ç–∞–º —Ñ–∞–π–ª `lesson.yaml`.  –°–∫–∞—á–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª [–ø–æ —Å—Å—ã–ª–∫–µ](https://github.com/locusclassicus/text_analysis_2023/blob/main/files/lesson.yaml) –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫–µ. –ù–µ –º–µ–Ω—è–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ! –û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã [–∑–¥–µ—Å—å](https://github.com/swirldev/swirl_courses/issues/394). 
::::


**–í—Å–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏, –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å?**

::::{.callout-tip icon=false collapse=true}
## –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É.
–ù—É –∏ –ª–∞–¥–Ω–æ, –¥–≤–∏–≥–∞–π—Ç–µ—Å—å –¥–∞–ª—å—à–µ.
::::


**–í—Å–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å?**

::::{.callout-tip icon=false collapse=true}
## –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É.
–ö–ª–∞—Å—Å! –î–≤–∏–≥–∞–π—Ç–µ—Å—å –¥–∞–ª—å—à–µ.
::::


–í—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–æ–≤! –û–±—ã—á–Ω—ã–π –¥–∞—Ç–∞—Ñ—Ä–µ–π–º –∏–ª–∏ —Ç–∏–±–±–ª?

::::{.callout-tip icon=false}
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —Ä—è–¥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å.
::::

```{r echo=FALSE, results='asis'}
library(checkdown)
check_question("—Ç–∏–±–±–ª", options = c("–¥–∞—Ç–∞—Ñ—Ä–µ–π–º", "—Ç–∏–±–±–ª"), type = "radio", right = "‚úÖ", wrong =  "‚ùå")
```
 
::::{.callout-tip icon=false}
–ú–æ–ª—á–∞–ª–∏–≤–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤.
::::
```{r echo=FALSE, results='asis'}
check_question("–¥–∞—Ç–∞—Ñ—Ä–µ–π–º", options = c("–¥–∞—Ç–∞—Ñ—Ä–µ–π–º", "—Ç–∏–±–±–ª"), type = "radio", right = "‚úÖ", wrong =  "‚ùå")
```

::::{.callout-tip icon=false}
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–∫—Ç–æ—Ä—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö. 
::::

```{r echo=FALSE, results='asis'}
check_question("–¥–∞—Ç–∞—Ñ—Ä–µ–π–º", options = c("–¥–∞—Ç–∞—Ñ—Ä–µ–π–º", "—Ç–∏–±–±–ª"), type = "radio", right = "‚úÖ", wrong =  "‚ùå")
```

::::{.callout-tip icon=false}
–ù–µ –∏–º–µ–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–π —Ä—è–¥–æ–≤.
::::

```{r echo=FALSE, results='asis'}
check_question("—Ç–∏–±–±–ª", options = c("–¥–∞—Ç–∞—Ñ—Ä–µ–π–º", "—Ç–∏–±–±–ª"), type = "radio", right = "‚úÖ", wrong =  "‚ùå")
```

–ö—Å—Ç–∞—Ç–∏, –æ–±—Ä–∞—Ç–∏–ª–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä `<=` —Å —Å–∏–º–≤–æ–ª—å–Ω—ã–º –≤–µ–∫—Ç–æ—Ä–æ–º? 

### Dplyr

–í —É—Ä–æ–∫–µ `swirl` –≤—ã—à–µ –≤—ã —É–∂–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å "–≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö", –ª–µ–∂–∞—â–µ–π –≤ –æ—Å–Ω–æ–≤–µ `dplyr`[^03-tidy-3]. –ó–¥–µ—Å—å –æ–± —ç—Ç–æ–º –±—É–¥–µ—Ç —Å–∫–∞–∑–∞–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ. –≠—Ç–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –≥–ª–∞–≥–æ–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Ä–µ—à–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏:

[^03-tidy-3]: <https://dplyr.tidyverse.org/>

-   `mutate()` –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö;
-   `select()` –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –∏–º–µ–Ω;
-   `filter()` –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π;
-   `summarise()` –æ–±–æ–±—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è;
-   `arrange()` –∏–∑–º–µ–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫.

–í—Å–µ —ç—Ç–∏ –≥–ª–∞–≥–æ–ª—ã –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —Å–æ—á–µ—Ç–∞—é—Ç—Å—è —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `group_by()`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ "–ø–æ –≥—Ä—É–ø–ø–∞–º", –∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º **pipe** `%>%` –∏–∑ –ø–∞–∫–µ—Ç–∞ `magrittr`.

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –±–æ–ª–µ–µ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π –∏ —á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥, —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ.

```{r}
diorisis_meta %>% 
  select(-subgenre) %>% 
  filter(genre == "Narrative") %>%  
  group_by(name) %>% 
  count() %>% 
  arrange(-n)
```

–í –±–∞–∑–æ–≤–æ–º R –º—ã –±—ã –¥–µ–ª–∞–ª–∏ —Ç–æ –∂–µ —Å–∞–º–æ–µ –≤–æ—Ç —Ç–∞–∫:

```{r}
diorisis_df <- as.data.frame(diorisis_meta)
diorisis_select <- diorisis_df[,-5] # remove column
diorisis_filter <- diorisis_select[diorisis_select$genre == "Narrative", ]
diorisis_names <- diorisis_filter$name
diorisis_count <- as.data.frame(table(diorisis_names))
diorisis_sort <- diorisis_count[order(diorisis_count$Freq, decreasing =T),]
head(diorisis_sort)
```

–¢—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫–æ–π-—Ç–æ –ø–æ—É—á–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥. –ù–æ –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –±—É–¥–µ—Ç –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–æ–¥–∏–Ω–≥. –í–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Ç–∞–∫ —á—Ç–æ —Å–≥—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ—Å—å.

::::{.callout-warning icon=false}
–ó–∞–ø—É—Å—Ç–∏—Ç–µ `swirl()`, –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å `Getting and Cleaning Data` –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∏–∑ –Ω–µ–≥–æ —É—Ä–æ–∫ 2 `Grouping and Chaining with dplyr`.
::::

–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å?

::::{.callout-tip icon=false}
–§—É–Ω–∫—Ü–∏—è `n_distinct()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. 
::::

```{r echo=FALSE, results='asis'}
check_question("–õ–æ–∂—å", type = "radio", options = c("–ü—Ä–∞–≤–¥–∞", "–õ–æ–∂—å"), right = "‚úÖ", wrong =  "‚ùå")
```

::::{.callout-tip icon=false}
–ï—Å–ª–∏ `x <- 1:100`, —Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `quantile(x, probs = 0.9)` –≤–µ—Ä–Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç 91 –¥–æ 100. 
::::

```{r echo=FALSE, results='asis'}
check_question("–õ–æ–∂—å", type = "radio", options = c("–ü—Ä–∞–≤–¥–∞", "–õ–æ–∂—å"), right = "‚úÖ", wrong =  "‚ùå")
```


::::{.callout-note icon=false}
–ö–≤–∞–Ω—Ç–∏ÃÅ–ª—å –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–¥–∞–Ω–Ω–∞—è —Å–ª—É—á–∞–π–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ 90% –¥–∞–Ω–Ω—ã—Ö –Ω–∏–∂–µ 90.1.
:::

–≠—Ç–æ –±—ã–ª–æ —Å–ª–æ–∂–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ä—ã–≤ ‚òï


## –û–ø—Ä—è—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ù–æ tidyverse -- —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Å–æ–±—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –Ω–æ –∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–¥–µ–æ–ª–æ–≥–∏—è "–æ–ø—Ä—è—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö". "–°—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º, —Ä–µ–¥–∫–æ –±—ã–≤–∞—é—Ç –æ–ø—Ä—è—Ç–Ω—ã, –∏ –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏–∑–æ–º –∏—Ö —Å–ª–µ–¥—É–µ—Ç "–ø–æ—á–∏—Å—Ç–∏—Ç—å" –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å[^03-tidy-4].

[^03-tidy-4]: <https://r4ds.had.co.nz/tidy-data.html>

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ä—è—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

-   –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π;
-   –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä—è–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è;
-   —É –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —è—á–µ–π–∫–∞;
-   –æ–¥–∏–Ω –¥–∞—Ç–∞—Å–µ—Ç -- –æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞.

![_–ü—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ä—è—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö_. [–ò—Å—Ç–æ—á–Ω–∏–∫](https://r4ds.had.co.nz/tidy-data.html).](https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png)

</br>

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —É—á–µ–±–Ω—ã–µ —Ç–∏–±–±–ª—ã –∏–∑ –ø–∞–∫–µ—Ç–∞ `tidyr` –∏ –ø–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫–æ–µ –∏–∑ —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –Ω–∞—Ä—É—à–µ–Ω–æ –≤ –∫–∞–∂–¥–æ–º —Å–ª—É—á–∞–µ. 

```{r}
data("table2")
table2
data("table3")
table3

data("table4a")
table4a
data("table4b")
table4b
```

–í–∞–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–∫–µ—Ç–∞ `tidyr`:^[https://tidyr.tidyverse.org/reference/index.html]

- `separate()` –¥–µ–ª–∏—Ç –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü –Ω–∞ –Ω–æ–≤—ã–µ;
- `unite()` –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å—Ç–æ–ª–±—Ü—ã;
- `pivot_longer()` —É–¥–ª–∏–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É;
- `pivot_wider()` —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É;
- `drop_na()` –∏ `replace_na()` —É–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å NA –∏ –¥—Ä.

–¢–∞–∫–∂–µ —É–ø–æ–º—è–Ω–µ–º —Ñ—É–Ω–∫—Ü–∏—é `distinct()` –∏–∑ `dplyr`, –∫–æ—Ç–æ—Ä–∞—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—Å—Ç–∞–ª—è–µ—Ç —Å–æ–±–æ–π –∞–Ω–∞–ª–æ–≥ –±–∞–∑–æ–≤–æ–π `unique()` –¥–ª—è —Ç–∞–±–ª–∏—Ü.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤ `dplyr` –µ—Å—Ç—å –ø–æ–ª–µ–∑–Ω–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π `_join`, –ø–æ–∑–≤–æ–ª—è—é—â–∏—Ö –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.[^03-tidy-5] –î–∞–ª—å—à–µ –º—ã –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è —Å –Ω–∏–º–∏ —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–µ–º —É—Ä–æ–∫ `swirl`. –≠—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω—ã–π —É—Ä–æ–∫ (—Å–Ω–æ–≤–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç), –Ω–æ –æ–Ω –Ω–∞–º –¥–∞–ª—å—à–µ –∑–¥–æ—Ä–æ–≤–æ –ø–æ–º–æ–∂–µ—Ç. 


[^03-tidy-5]: <https://r4ds.had.co.nz/relational-data.html>

::::{.callout-warning icon=false}
–ó–∞–ø—É—Å—Ç–∏—Ç–µ `swirl()`, –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å `Getting and Cleaning Data` –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∏–∑ –Ω–µ–≥–æ —É—Ä–æ–∫ 3 `Tidying Data with tidyr`.
::::

–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å?

::::{.callout-tip icon=false}
–§—É–Ω–∫—Ü–∏—è `separate()` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å.
::::

```{r echo=FALSE, results='asis'}
check_question("–õ–æ–∂—å", options = c("–ü—Ä–∞–≤–¥–∞", "–õ–æ–∂—å"), type = "select", right = "‚úÖ", wrong =  "‚ùå")
```

::::{.callout-tip icon=false}
–ü—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ä—è—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–±—É—é—Ç, —á—Ç–æ–±—ã –æ–¥–Ω–æ–º—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü.
::::

```{r echo=FALSE, results='asis'}
check_question("–õ–æ–∂—å", options = c("–ü—Ä–∞–≤–¥–∞", "–õ–æ–∂—å"), type = "select", right = "‚úÖ", wrong =  "‚ùå")
```

::::{.callout-tip icon=false}
–§—É–Ω–∫—Ü–∏—è `contains()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å `filter()` –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä—è–¥–æ–≤.
::::

```{r echo=FALSE, results='asis'}
check_question("–õ–æ–∂—å", options = c("–ü—Ä–∞–≤–¥–∞", "–õ–æ–∂—å"), type= "select", right = "‚úÖ", wrong =  "‚ùå")
```

–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ü—Ä–µ–∂–¥–µ —á–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ, –ø—Ä–∏–≤–µ–¥–∏—Ç–µ –≤ –ø–æ—Ä—è–¥–æ–∫ table2, 3, 4a-4b (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ç–∞–∫–∂–µ –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ) –≤ –µ–¥–∏–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç.


::::{.callout-warning icon=false}
–ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï 3: –ë–ò–ë–õ–ò–û–¢–ï–ö–ê GUTENBERG
::::

</br>

```{r eval=FALSE}
devtools::install_github("ropensci/gutenbergr")
library(gutenbergr)
library(dplyr)
library(tidyr)

works <- gutenberg_works()

# –û—Ç–±–µ—Ä–∏—Ç–µ —Ä—è–¥—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö gutenberg_author_id —Ä–∞–≤–µ–Ω 65;
# –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ —Å—Ç–æ–ª–±—Ü–∞: author, title
my_data <- works %>% 
  # –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
  
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–∞—Ö –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ–ª–±—Ü—ã: author, deathdate
authors <- gutenberg_authors %>% 
  # –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å

# –°–æ–µ–¥–∏–Ω–∏—Ç–µ my_data —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Å–º–µ—Ä—Ç–∏ –∞–≤—Ç–æ—Ä–∞ –∏–∑ authors, 
# —Ç–∞–∫ —á—Ç–æ–±—ã –∫ my_data –¥–æ–±–∞–≤–∏–ª—Å—è –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü. 
# –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é separate, 
# —á—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü —Å –∏–º–µ–Ω–µ–º –∏ —Ñ–∞–º–∏–ª–∏–µ–π –Ω–∞ –¥–≤–∞ –Ω–æ–≤—ã—Ö: author, name. 
# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–æ–ª–±–µ—Ü —Å –∏–º–µ–Ω–µ–º –∞–≤—Ç–æ—Ä–∞, –æ—Å—Ç–∞–≤–∏–≤ —Ç–æ–ª—å–∫–æ —Ñ–∞–º–∏–ª–∏—é.
# –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü century, 
# –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é mutate –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ deathdate. 
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä pipe, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!

my_data %>% 
  # –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
  
```


## –ü—Ä–∏–º–µ—Ä: –±—É–∫–∫—Ä–æ—Å—Å–∏–Ω–≥

### –°–º–æ—Ç—Ä–∏–º –Ω–∞ –¥–∞–Ω–Ω—ã–µ

–ó–∞–≥—Ä—É–∑–∏–º –ø—Ä–∏–º–µ—Ä –Ω–µ–æ–ø—Ä—è—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ø—Ä–æ–±—É–µ–º –∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. [Book-Crossing](https://www.kaggle.com/datasets/ruchi798/bookcrossing-dataset) -- –¥–∞—Ç–∞—Å–µ—Ç —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∫–Ω–∏–≥ –∏ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–º–∏ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –æ –±–æ–ª–µ–µ 250 —Ç—ã—Å—è—á–∞—Ö –∏—Ö —á–∏—Ç–∞—Ç–µ–ª–µ–π. –≠—Ç–æ—Ç –¥–∞—Ç–∞—Å–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç—Ä–µ—Ö —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤–æ–º [–æ—Ç—Å—é–¥–∞](https://github.com/locusclassicus/text_analysis_2024/raw/main/files/BX.zip). –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∞—Ä—Ö–∏–≤, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –Ω–∏–∂–µ. 


```{r eval=FALSE}
ratings <- read_delim("../files/BX/BX-Book-Ratings.csv", delim = ";")
ratings

books <- read_delim("../files/BX/BX_Books.csv", delim = ";")
books

users <- read_delim("../files/BX/BX-Users.csv", delim = ";")
users
```

```{r eval=FALSE}
save(users, file = "../data/UsersBX.Rdata")
save(books, file = "../data/BooksBX.Rdata")
save(ratings, file = "../data/RatingsBX.Rdata")
```
 
```{r echo=FALSE}
load("../data/BooksBX.Rdata")
load("../data/RatingsBX.Rdata")
load("../data/UsersBX.Rdata")
```

```{r}
head(ratings)
head(users)
head(books)
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏?

:::{.callout-tip icon=false collapse=true}
## –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
-   `users` —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ Location
-   –º–Ω–æ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
-   –¥–∞–Ω–Ω—ã–µ –≤–≤–æ–¥—è—Ç—Å—è —Å–∞–º–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ —Å–∞–π—Ç <https://www.bookcrossing.com/> ; –æ–Ω–∏ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —Å–º. –Ω–∞–ø—Ä. `moscow, yukon territory, russia` (–Æ–∫–æ–Ω -- —ç—Ç–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è –ö–∞–Ω–∞–¥—ã).
-   Age –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å—Ç—Ä–æ–∫—É –∏ –¥—Ä.
:::


–ü—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∏–Ω–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –Ω–∞–¥–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∏ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –¥–ª—è –Ω–∞—Å –≤–∞–∂–Ω–æ, –∞ —á—Ç–æ –Ω–µ—Ç.

:::{.callout-tip icon=false collapse=true}
## –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
- –°–∫–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π —Å—Ç–∞—Ä—à–µ 30 –ª–µ—Ç –ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º –≤ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏? 
- –í –∫–∞–∫–∏–µ –≥–æ–¥–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏? 
- –ö—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω–µ–µ —É —á–∏—Ç–∞—Ç–µ–ª–µ–π, –†–æ—É–ª–∏–Ω–≥ –∏–ª–∏ –¢–æ–ª–∫–∏–Ω?
- –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤—ã?
- –ï—Å—Ç—å –ª–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É –≤–æ–∑—Ä–∞—Å—Ç–æ–º –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Ü–µ–Ω–æ–∫?
–∏ —Ç.–ø.
:::

–ß—Ç–æ–±—ã –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–∞–¥–æ –ø–æ–Ω—è—Ç—å, —á–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã.

:::{.callout-tip icon=false collapse=true}
## –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
–û—Ç–≤–µ—Ç: `ratings` –∏ `books` —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `isbn`, `ratings` –∏ `users` —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `User-ID`.
:::

### –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ

–ù–∞—á–Ω–µ–º —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```{r warning=FALSE}
users_separated <- users %>% 
  mutate(Age = as.numeric(Age)) %>%
  filter(!is.na(Age))  %>% # drop_na(Age) —Ç–æ–∂–µ —Ä–µ—à–∏–ª –±—ã –Ω–∞—à—É –∑–∞–¥–∞—á—É
  separate(Location, into = c(NA, NA, "country"), sep = ",")

head(users_separated) # –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å, –Ω–æ —Ç–∞–∫ –Ω–∞–≥–ª—è–¥–Ω–µ–µ
```

–ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∏–∑ –∫–∞–∫–∏—Ö —Å—Ç—Ä–∞–Ω –∏ –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.

```{r}
users_separated %>% 
  group_by(country) %>%
  count() %>% 
  arrange(-n)
```
–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä—è–¥—ã —ç—Ç–æ–≥–æ —Ç–∏–±–ª–∞ –≤—ã–≥–ª—è–¥—è—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∏—á—É–¥–ª–∏–≤–æ:

```{r}
users_separated %>% 
  group_by(country) %>%
  count() %>% 
  arrange(n)
```

–ó–¥–µ—Å—å –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π. –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≤—Å–µ —Ä—è–¥—ã —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω –ª–∏–±–æ (–µ—Å–ª–∏ —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–¥–∞—á–µ) –∫–∞–∫—É—é-—Ç–æ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω—É. –ú–æ–∂–Ω–æ –∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω–æ.

–î–æ–ø—É—Å—Ç–∏–º, –º—ã —Ä–µ—à–∞–µ–º —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ò—Å–ø–∞–Ω–∏–∏. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–µ–π `separate()` –ø–æ–ø–∞–ª–∏ –ø—Ä–æ–±–µ–ª—ã, –∏ –æ—Ç –Ω–∏—Ö –Ω–∞–¥–æ –∏–∑–±–∞–≤–∏—Ç—å—Å—è. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π (–æ –Ω–∏—Ö –≤ –¥—Ä—É–≥–æ–π —Ä–∞–∑) –∏ —Ñ—É–Ω–∫—Ü–∏–∏ `mutate()`.

```{r}
spain_data <- users_separated %>%
  mutate(country = str_replace_all(country, pattern = "\\s+", "")) %>% # —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–±–µ–ª –º—ã –º–µ–Ω—è–µ–º –Ω–∞ "–Ω–∏—á—Ç–æ", —Ç.–µ. —É–±–∏—Ä–∞–µ–º
  filter(country == "spain") %>% 
  group_by(Age) %>%
  count() %>% 
  arrange(-n)

head(spain_data)
```

–°—Ç–æ–ª–±–∏–∫–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–æ–±–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```{r}
spain_data %>% 
  ggplot(aes(Age, n)) + 
  geom_bar(stat = "identity", col = "blue", fill = "white") +
  theme_bw()
```

–ö–∞–∫–∏–µ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω—ã–µ –∏—Å–ø–∞–Ω—Ü—ã! –ß–∏—Ç–∞—é—Ç –æ—Ç 0 –¥–æ 183 –ª–µ—Ç üòµ

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã —É–±—Ä–∞–ª–∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç—Ä–∞–Ω, –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å:

```{r}
spain_id <- users_separated %>%
  mutate(country = str_replace_all(country, pattern = "\\s+", "")) %>%
  filter(country == "spain") # –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –º—ã –Ω–µ —Å—á–∏—Ç–∞–µ–º —á–∏—Å–ª–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–µ, –∞ –∑–∞–±–∏—Ä–∞–µ–º –≤—Å–µ —Ä—è–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞—é—Ç —É—Å–ª–æ–≤–∏—é
```

```{r echo=F}
# –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
# book_crossing <- users_separated %>%
#   mutate(country = str_replace_all(country, pattern = "\\s+", "")) %>% 
#   left_join(ratings) %>% 
#   left_join(books) %>% 
#   select(-contains("URL"), -matches("Publisher")) %>% 
#   rename(title = `Book-Title`, 
#          author = `Book-Author`,
#          published = `Year-Of-Publication`,
#          rating = `Book-Rating`)

#save(book_crossing, file = "data/Bookcrossing.Rdata")
```

### –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ

–ú—ã —É–∂–µ –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ `ratings` –∏ `users` —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `User-ID`, –∏ –≤ `ratings` —Ö–æ—Ç–µ–ª–∏ –±—ã –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ id, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞–¥–∞–Ω–Ω–æ–º—É —É—Å–ª–æ–≤–∏—é (—Å—Ç—Ä–∞–Ω–∞, –≤–æ–∑—Ä–∞—Å—Ç –∏ —Ç.–ø.). –î–ª—è —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–π –∫–∞–∫ —Ä–∞–∑ –ø–æ–¥—Ö–æ–¥—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `_join`^[https://r4ds.had.co.nz/relational-data.html].

[–§—É–Ω–∫—Ü–∏–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞ _join](https://d33wubrfki0l68.cloudfront.net/9c12ca9e12ed26a7c5d2aa08e36d2ac4fb593f1e/79980/diagrams/join-outer.png){ width=70% }


```{r}
spain_ratings <- spain_id %>% 
  left_join(ratings) %>% 
  filter(!is.na(ISBN)) %>% 
  filter(`Book-Rating` > 7) %>% # –∏–º–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–Ω–∞–∫ "`"
  group_by(ISBN) %>% 
  count() %>% 
  arrange(-n)

spain_ratings
```

–û—Å—Ç–∞–ª–æ—Å—å –≤—ã—è—Å–Ω–∏—Ç—å, —á—Ç–æ —ç—Ç–æ –∑–∞ –∫–Ω–∏–≥–∏. –î–ª—è —ç—Ç–æ–≥–æ –æ–±—ä–µ–¥–∏–Ω—è–µ–º `spain_ratings` –∏ `books`. 

```{r message=FALSE}
spain_books <- spain_ratings %>% 
  filter(n > 2) %>% 
  left_join(books) %>% 
  filter(!is.na(`Book-Title`), !is.na(`Book-Author`)) %>% 
  ungroup()

spain_books
```

–ö–∞–∫ –º–∏–Ω–∏–º—É–º –º—ã –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ –∏—Å–ø–∞–Ω—Ü—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç —á–∏—Ç–∞—Ç—å –ø–æ-–∏—Å–ø–∞–Ω—Å–∫–∏! (–ó–¥–µ—Å—å —Å–Ω–æ–≤–∞ –º–æ–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ, —É –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏ —Ä–∞–∑–Ω—ã–µ ISBN, –∏ —Å—Ç–æ–∏–ª–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –ø–æ ISBN, –∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É?)

–û—Å—Ç–∞–ª–æ—Å—å –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ (—ç—Ç–æ —Å—Å—ã–ª–∫–∏, —á–∞—Å—Ç–æ –±–∏—Ç—ã–µ, –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–ª–æ–∂–∫–∏). –ï—Å–ª–∏ –º—ã –∑–Ω–∞–µ–º –Ω–æ–º–µ—Ä–∞ —ç—Ç–∏—Ö —Å—Ç–æ–ª–±—Ü–æ–≤, —Ç–æ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ –∏–Ω–¥–µ–∫—Å—É:


```{r}
spain_books %>% 
  select(3:5) %>% 
  rename(title = `Book-Title`, author = `Book-Author`)
```

–û–¥–Ω–∞–∫–æ —É `select()` –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏-–ø–æ–º–æ—â–Ω–∏–∫–∏^[https://r4ds.had.co.nz/transform.html], –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤:

- `starts_with()`
- `ends_with()`
- `contains()`
- `matches()`
- `num_range()`

```{r}
spain_books %>% 
  select(-contains("URL"), -matches("Publisher")) %>% # —É–¥–∞–ª–∏–º –∑–∞–æ–¥–Ω–æ –∏ –∏–∑–¥–∞—Ç–µ–ª—è
  rename(title = `Book-Title`, 
         author = `Book-Author`,
         published = `Year-Of-Publication`) # —á–∏–Ω–∏–º –∏–º–µ–Ω–∞
```

–£—Ä–∞! –ï—â–µ –æ–¥–∏–Ω —Å–ª–æ–∂–Ω—ã–π —É—Ä–æ–∫ –ø–æ–∑–∞–¥–∏. –ü–æ—Ö–≤–∞–ª–∏—Ç–µ —Å–µ–±—è. 

![](https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzFieW5lM21iMW41cTZpcWJ4OTV6Z2ZrMndocWo3cHBod2ZvZ3VldCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/qYGvebgOKGygdQgflY/giphy.gif)
