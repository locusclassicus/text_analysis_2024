# –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤

## –í–µ–∫—Ç–æ—Ä—ã –≤ –ª–∏–Ω–≥–≤–∏—Å—Ç–∏–∫–µ 

–í–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤ - —ç—Ç–æ —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—é —è–∑—ã–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å _—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π_ –∞–Ω–∞–ª–∏–∑ —Å–ª–æ–≤ –∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–∑ –Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–∏–Ω–æ–Ω–∏–º—ã –∏ –∫–≤–∞–∑–∏—Å–∏–Ω–æ–Ω–∏–º—ã, –∞ —Ç–∞–∫–∂–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–≤ –≤ –¥–∏–∞—Ö—Ä–æ–Ω–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ. 

–í –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –≤–µ–∫—Ç–æ—Ä -- —ç—Ç–æ –æ–±—ä–µ–∫—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –¥–ª–∏–Ω–∞ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∑–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –≤–µ–∫—Ç–æ—Ä–∞. –ú—ã –º–æ–∂–µ–º –∏–∑–æ–±—Ä–∞–∑–∏—Ç—å –≤–µ–∫—Ç–æ—Ä –≤ –¥–≤—É–º–µ—Ä–Ω–æ–º –∏–ª–∏ —Ç—Ä–µ—Ö–º–µ—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ, –≥–¥–µ —Ç–∞–∫–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–≤–µ –∏–ª–∏ —Ç—Ä–∏ (–ø–æ —á–∏—Å–ª—É –∏–∑–º–µ—Ä–µ–Ω–∏–π), –Ω–æ —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 100- –∏–ª–∏ –¥–∞–∂–µ 1000-–º–µ—Ä–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞: –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç—Ç–æ –≤–ø–æ–ª–Ω–µ –≤–æ–∑–º–æ–∂–Ω–æ. –û–±—ã—á–Ω–æ, –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä—è—Ç –æ –≤–µ–∫—Ç–æ—Ä–∞—Ö —Å–ª–æ–≤, –∏–º–µ—é—Ç –≤ –≤–∏–¥—É –∏–º–µ–Ω–Ω–æ –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ. 

–ß—Ç–æ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è–º –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º? –ï—Å—Ç—å [–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π](https://web.stanford.edu/~jurafsky/li15/lec3.vector.pdf). 

–ú—ã –º–æ–∂–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞—Ç—å _–º–∞—Ç—Ä–∏—Ü—É —Ç–µ—Ä–º–∏–Ω-–¥–æ–∫—É–º–µ–Ω—Ç_, –≥–¥–µ –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ "–æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è" –≤–µ–∫—Ç–æ—Ä–æ–º –µ–≥–æ –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö (—Ä–∞–∑–¥–µ–ª–∞—Ö, –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞—Ö...). –°–ª–æ–≤–∞  —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ—Ö–æ–∂–∏–º–∏, –µ—Å–ª–∏ "–ø–æ—Ö–æ–∂–∏" –∏—Ö –≤–µ–∫—Ç–æ—Ä—ã (–æ —Ç–æ–º, –∫–∞–∫ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã, –º—ã —Å–∫–∞–∂–µ–º —á—É—Ç—å –¥–∞–ª—å—à–µ). –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏ —Å–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã.

–í—Ç–æ—Ä–æ–π –ø–æ–¥—Ö–æ–¥ -- –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç—å (–∏–ª–∏ –¥—Ä—É–≥—É—é –º–µ—Ä—É –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏) –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –º—ã —Å—Ç—Ä–æ–∏–º _–º–∞—Ç—Ä–∏—Ü—É —Ç–µ—Ä–º–∏–Ω-—Ç–µ—Ä–º–∏–Ω_. –ó–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —á–∞—Å—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ, –∞ –Ω–µ —Ü–µ–ª—ã–π –¥–æ–∫—É–º–µ–Ω—Ç. –ù–µ–±–æ–ª—å—à–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ (–Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–ø–ª–∏–∫–∏) —Å–∫–æ—Ä–µ–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –±–æ–ª—å—à–µ _—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π_ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–æ–µ –æ–∫–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∫–æ—Ä–µ–µ —Å—É–¥–∏—Ç—å –æ _—Å–µ–º–∞–Ω—Ç–∏–∫–µ_: –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –º—ã —Å–∫–æ—Ä–µ–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω—ã –≤ —Å–ª–æ–≤–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –ø–æ—Ö–æ–∂–∏—Ö —Å–æ—Å–µ–¥–µ–π. 

–ò –º–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Ä–º–∏–Ω-–¥–æ–∫—É–º–µ–Ω—Ç, –∏ –º–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Ä–º–∏–Ω-—Ç–µ—Ä–º–∏–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±—É–¥—É—Ç –¥–ª–∏–Ω–Ω—ã–º–∏ –∏ —Å–∏–ª—å–Ω–æ —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–º–∏ (sparse), —Ç.–µ. –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π –≤ –Ω–∏—Ö –±—É–¥–µ—Ç —Ä–∞–≤–Ω–∞ 0. –° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —ç—Ç–æ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª—å—à–æ–π —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –Ω–æ –º–æ–∂–µ—Ç —Å–ª—É–∂–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º "—à—É–º–∞", –ø–æ—ç—Ç–æ–º—É –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –≤–º–µ—Å—Ç–æ –Ω–∏—Ö —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ –ø–ª–æ—Ç–Ω—ã–µ (dense) –≤–µ–∫—Ç–æ—Ä—ã, –∏–ª–∏ _—ç–º–±–µ–¥–¥–∏–Ω–≥–∏_. –î–ª—è —ç—Ç–æ–≥–æ –∫ –∏—Å—Ö–æ–¥–Ω–æ–π –º–∞—Ç—Ä–∏—Ü–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏. 

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö –º–æ–∂–µ–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å [—Å—Ç–∞—Ç—å—é](https://sysblok.ru/knowhow/word2vec-pokazhi-mne-svoj-kontekst-i-ja-skazhu-kto-ty/) –í. –°–µ–ª–µ–≤–µ—Ä—Å—Ç–æ–≤–∞ –Ω–∞ "–°–∏—Å—Ç–µ–º–Ω–æ–º –±–ª–æ–∫–µ", –∞ —Ç–∞–∫–∂–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [–≤–∏–¥–µ–æ](https://youtu.be/1ng7vHBo9bY?si=H9BFpG1MQNt-ije-) —Å –ª–µ–∫—Ü–∏–µ–π –î. –†—ã–∂–æ–≤–æ–π.

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –∏–∑—É—á–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ—Å—Ç—Ä–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: 

- –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏ —Å–ª–æ–≤ —Å [–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PMI](https://smltar.com/embeddings);
- —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–π –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ Word2Vec;
- c –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞ BERT.

–¢–∞–∫–∂–µ –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≥–æ—Ç–æ–≤—ã—Ö (–ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö) —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤.

```{r message=FALSE}
library(tidyverse)
library(tidytext)
library(stopwords)
library(widyr)
library(uwot)
library(text)
```

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ú—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è [–¥–∞—Ç–∞—Å–µ—Ç–æ–º](https://www.kaggle.com/datasets/marialevchenko/news-dataset-from-lenta-ru-2019-2023/data) —Å –ø–æ–¥–±–æ—Ä–∫–æ–π –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤–æ–∑—å–º–µ–º –∏–∑ –Ω–µ–≥–æ –ª–∏—à—å –æ–¥–∏–Ω –≥–æ–¥). –§–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.Rdata` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.Rdata`  –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ](https://github.com/locusclassicus/text_analysis_2024/raw/main/data/news.Rdata).



<details>
  <summary>–ö–æ–¥ –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –∫ –æ–ø—Ä—è—Ç–Ω–æ–º—É –≤–∏–¥—É.</summary>
  <p>
  
```{r}
load("../data/news.Rdata")

news_2019 <- news_2019 |> 
  mutate(id = paste0("doc", row_number()))
```

–°–æ—Å—Ç–∞–≤–∏–º —Å–ø–∏—Å–æ–∫ —Å—Ç–æ–ø-—Å–ª–æ–≤.

```{r eval=FALSE}
stopwords_ru <- c(
  stopwords("ru", source = "snowball"),
  stopwords("ru", source = "marimo"),
  stopwords("ru", source = "nltk"), 
  stopwords("ru", source  = "stopwords-iso")
  )

stopwords_ru <- sort(unique(stopwords_ru))
length(stopwords_ru)
```

–†–∞–∑–¥–µ–ª–∏–º —Å—Ç–∞—Ç—å–∏ –Ω–∞ —Å–ª–æ–≤–∞ –∏ —É–¥–∞–ª–∏–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞; —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.

```{r eval=FALSE}
news_tokens <- news_2019 |> 
  unnest_tokens(token, text) |> 
  filter(!token %in% stopwords_ru)
```

–ú–Ω–æ–≥–∏–µ —Å–ª–æ–≤–∞ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏ –¥–ª—è —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã. –ü–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –æ—Ç –Ω–∏—Ö –∏–∑–±–∞–≤–∏—Ç—å—Å—è.

```{r eval=FALSE}
news_tokens_pruned <- news_tokens |> 
  add_count(token) |> 
  filter(n > 10) |> 
  select(-n)
```

–¢–∞–∫–∂–µ –∏–∑–±–∞–≤–∏–º—Å—è –æ—Ç —Ü–∏—Ñ—Ä, —Ö–æ—Ç—è —Å—Ç–æ–∏—Ç –∏–º–µ—Ç—å –≤ –≤–∏–¥—É, —á—Ç–æ –∏—Ö –ø—Ä–∏—Å—Ç—É—Ç—Å—Ç–≤–∏–µ –≤ —Ç–µ–∫—Å—Ç–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —Ç–µ–º—ã: –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—Ö –ª—É—á—à–µ –Ω–µ —É–¥–∞–ª—è—Ç—å —Ü–∏—Ñ—Ä—ã, –∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–º–µ–Ω—è—Ç—å –∏—Ö –Ω–∞ –Ω–µ–∫—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ –≤—Ä–æ–¥–µ `digit` –∏ —Ç.–ø. –¢–æ–∫–µ–Ω—ã –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ —Ç–æ–∂–µ —É–¥–∞–ª—è–µ–º.

```{r eval=FALSE}
news_tokens_pruned <- news_tokens_pruned |> 
  filter(str_detect(token, "[\u0400-\u04FF]")) |> 
  filter(!str_detect(token, "\\d"))
```

```{r eval=FALSE}
news_tokens_pruned
```

–≠—Ç–∞–ø –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö -- —Å–∞–º—ã–π —Ç—Ä—É–¥–æ–µ–º–∫–∏–π –∏ –Ω–µ —Å–∞–º—ã–π —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π, –Ω–æ –Ω–µ —Å—Ç–æ–∏—Ç –∏–º –ø—Ä–µ–Ω–µ–±—Ä–µ–≥–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ—Ç —ç—Ç–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏. 

```{r echo=FALSE, eval=FALSE}
save(news_tokens_pruned, file = "../data/news_tokens_pruned.Rdata")
```

 </p>
</details>

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å –ø–æ [—Å—Å—ã–ª–∫–µ](https://github.com/locusclassicus/text_analysis_2024/raw/refs/heads/main/data/news_tokens_pruned.Rdata).

```{r}
load("../data/news_tokens_pruned.Rdata")
```


## PMI-SVD —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

### –°–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ

–ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∏–º  –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ–∫–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã. –ß–µ–º –º–µ–Ω—å—à–µ –æ–∫–Ω–æ, —Ç–µ–º –±–æ–ª—å—à–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–Ω–æ —Ö—Ä–∞–Ω–∏—Ç. 

```{r}
nested_news <- news_tokens_pruned |> 
  dplyr::select(-topic) |> 
  nest(tokens = c(token))

nested_news
```

```{r}
slide_windows <- function(tbl, window_size) {
  skipgrams <- slider::slide(
    tbl, 
    ~.x, 
    .after = window_size - 1, 
    .step = 1, 
    .complete = TRUE
  )
  
  safe_mutate <- safely(mutate)
  
  out <- map2(skipgrams,
              1:length(skipgrams),
              ~ safe_mutate(.x, window_id = .y))
  
  out  |> 
    transpose()  |> 
    pluck("result")  |> 
    compact()  |> 
    bind_rows()
}
```

–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ–∫–Ω–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç. –ß–µ–º –±–æ–ª—å—à–µ –æ–∫–Ω–æ, —Ç–µ–º –±–æ–ª—å—à–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç–µ–º –±–æ–ª—å—à–µ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã.

```{r eval=FALSE}
news_windows <- nested_news |> 
  mutate(tokens = map(tokens, slide_windows, 8L))  |>  
  unnest(tokens) |> 
  unite(window_id, id, window_id)

news_windows
```


```{r echo=FALSE, eval=FALSE}
save(news_windows, file = "../data/news_windows.Rdata")
```


```{r}
load("../data/news_windows.Rdata")
```

### –ß—Ç–æ —Ç–∞–∫–æ–µ PMI 

–û–±—ã—á–Ω–∞—è –º–µ—Ä–∞ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏, –∫–æ—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏–Ω–≥–≤–∏—Å—Ç—ã, ‚Äî —Ç–æ—á–µ—á–Ω–∞—è –≤–∑–∞–∏–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∏–ª–∏ PMI (pointwise mutual information). –û–Ω–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:

$$PMI\left(x;y\right)=\log{\frac{P\left(x,y\right)}{P\left(x\right)P\left(y\right)}}$$

–í —á–∏—Å–ª–∏—Ç–µ–ª–µ ‚Äî –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –¥–≤–∞ —Å–ª–æ–≤–∞ –≤–º–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–ª–∏ –æ–¥–Ω–æ–≥–æ ¬´–æ–∫–Ω–∞¬ª –¥–ª–∏–Ω–Ω–æ–π n —Å–ª–æ–≤). –í –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ ‚Äî –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –∫–∞–∂–¥–æ–µ –∏–∑ —Å–ª–æ–≤ –æ—Ç–¥–µ–ª—å–Ω–æ. –ï—Å–ª–∏ —Å–ª–æ–≤–∞ —á–∞—â–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ, –ª–æ–≥–∞—Ä–∏—Ñ–º –±—É–¥–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º; –µ—Å–ª–∏ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º. 

–ü–æ—Å—á–∏—Ç–∞–µ–º PMI –Ω–∞ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Å—å –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –∏–∑ –ø–∞–∫–µ—Ç–∞ `{widyr}`.

```{r}
news_pmi  <- news_windows  |> 
  pairwise_pmi(token, window_id)

news_pmi |> 
  arrange(-abs(pmi))
```

### –ü–æ—á–µ–º—É PPMI 

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, PMI –º–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç $-\infty$ –¥–æ $+\infty$, –Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω—ã. –û–Ω–∏ –æ–∑–Ω–∞—á–∞—é—Ç, —á—Ç–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å —ç—Ç–∏ –¥–≤–∞ —Å–ª–æ–≤–∞ –≤–º–µ—Å—Ç–µ _–º–µ–Ω—å—à–µ_, —á–µ–º –º—ã –±—ã –æ–∂–∏–¥–∞–ª–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ –±–µ–∑ –æ–≥—Ä–æ–º–Ω–æ–≥–æ –∫–æ—Ä–ø—É—Å–∞ [–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ](https://web.stanford.edu/~jurafsky/li15/lec3.vector.pdf): –µ—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å $w_1$ –∏ $w_2$, –∫–∞–∂–¥–æ–µ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é $10^{-6}$, —Ç–æ —Ç—Ä—É–¥–Ω–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–∏—Ç—å—Å—è –≤ —Ç–æ–º, —á—Ç–æ $p(w_1, w_2)$ –∑–Ω–∞—á–∏–º–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç $10^{-12}$.
–ü–æ—ç—Ç–æ–º—É –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è PMI –ø—Ä–∏–Ω—è—Ç–æ –∑–∞–º–µ–Ω—è—Ç—å –Ω—É–ª—è–º–∏. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Ñ–æ—Ä–º—É–ª–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

$$ PMI\left(x;y\right)=max(\log{\frac{P\left(x,y\right)}{P\left(x\right)P\left(y\right)}},0) $$
–î–ª—è –ø–æ–¥–æ–±–Ω–æ–π –∑–∞–º–µ–Ω—ã –ø–æ–¥–æ–π–¥–µ—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ.

```{r}
news_ppmi <- news_pmi |> 
  mutate(ppmi = case_when(pmi < 0 ~ 0, 
                          .default = pmi)) 

news_ppmi |> 
  arrange(pmi)
```


### SVD

–î–ª—è –ª—é–±—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Ä–º–∏–Ω-—Ç–µ—Ä–º–∏–Ω –±—É–¥–µ—Ç –æ—á–µ–Ω—å —Ä–∞–∑—Ä—è–∂–µ–Ω–Ω–æ–π (—Ç–æ –µ—Å—Ç—å –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π –±—É–¥–µ—Ç —Ä–∞–≤–Ω–∞ –Ω—É–ª—é). –ù–µ–æ–±—Ö–æ–¥–∏–º–æ "–ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å" –µ–µ —Ç–∞–∫, —á—Ç–æ–±—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Ç–µ–º–∞–º –∏ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –º–∞–ª–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ–º.

![[–ò—Å—Ç–æ—á–Ω–∏–∫.](https://sysblok.ru/knowhow/kak-ponjat-o-chem-tekst-ne-chitaja-ego/)](https://sysblok.ru/wp-content/uploads/2019/07/image16.gif)

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã (SVD). –ü—Ä–∏ —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ–º —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–∏ –∏—Å—Ö–æ–¥–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ $A_r$ –ø—Ä–æ–µ—Ü–∏—Ä—É–µ—Ç—Å—è –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–Ω—å—à–µ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏, —Ç–∞–∫ —á—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –º–∞—Ç—Ä–∏—Ü–∞ $A_k$, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–∞–ª–æ—Ä–∞–Ω–≥–æ–≤—É—é –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—é –∏—Å—Ö–æ–¥–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã [@–º–∞–Ω–Ω–∏–Ω–≥2020, 407]. 

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–π –º–∞—Ç—Ä–∏—Ü—ã –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞. –°–Ω–∞—á–∞–ª–∞ –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã $A_r$ —Å—Ç—Ä–æ–∏—Ç—Å—è –µ–µ —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ (Singular Value Decomposition) –ø–æ —Ñ–æ—Ä–º—É–ª–µ: $A = UŒ£V^t$ . –ò–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, –æ–¥–Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –≤–∏–¥–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ç—Ä–µ—Ö –¥—Ä—É–≥–∏—Ö, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ä–µ–¥–Ω—è—è - –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è. 

![–ò—Å—Ç–æ—á–Ω–∏–∫: –Ø–Ω–¥–µ–∫—Å –ü—Ä–∞–∫—Ç–∏–∫—É–º](https://pictures.s3.yandex.net/resources/3.3.7_skhema_5_1679315403.png)

–ó–¥–µ—Å—å `U` ‚Äî –º–∞—Ç—Ä–∏—Ü–∞ –ª–µ–≤—ã—Ö —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –º–∞—Ç—Ä–∏—Ü—ã `A`; `Œ£` ‚Äî –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö —á–∏—Å–µ–ª –º–∞—Ç—Ä–∏—Ü—ã `A`; `V` ‚Äî –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤—ã—Ö —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –º–∞—Ç—Ä–∏—Ü—ã `A`. –û —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–∞—Ö –º–æ–∂–Ω–æ –¥—É–º–∞—Ç—å  –∫–∞–∫ –æ —Ç–æ–ø–∏–∫–∞—Ö-–∏–∑–º–µ—Ä–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–¥–∞—é—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –Ω–∞—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. 

–°—Ç—Ä–æ–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã `U` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ª–æ–≤–∞–º, –ø—Ä–∏ —ç—Ç–æ–º –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ (–Ω–∞ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –æ–Ω–∏ –ø–æ–∫–∞–∑–∞–Ω—ã —Ä–∞–∑–Ω—ã–º–∏ –æ—Ç—Ç–µ–Ω–∫–∞–º–∏). –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤ `V^t` —Å—Ç–æ–ª–±—Ü—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫–∞–∂–¥–∞ —Å—Ç—Ä–æ–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã `U` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã —Å–ª–æ–≤–∞ —Å —Ç–æ–ø–∏–∫–∞–º–∏, –∞ —Å—Ç–æ–ª–±—Ü—ã `V^T` -- –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã —Ç–æ–ø–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ–∫—Ç–æ—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–±–æ–ª—å—à–∏–º —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º (–æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –º–∞—Ç—Ä–∏—Ü–µ) –∏ –ø–æ—Ç–æ–º—É —Ö—Ä–∞–Ω—è—Ç –º–∞–ª–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ –∏—Ö –æ—Ç—Å–µ–∫–∞—é—Ç. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–∏–º–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –º–∞—Ç—Ä–∏—Ü–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω—É–ª—è–º–∏. –¢–∞–∫–æ–µ SVD –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è _—É—Å–µ—á–µ–Ω–Ω—ã–º_. –°–∫–æ–ª—å–∫–æ —Ç–æ–ø–∏–∫–æ–≤ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏ —É—Å–µ—á–µ–Ω–∏–∏, —Ä–µ—à–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫. 

–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ _—ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏_, –∏–ª–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏ —Å–ª–æ–≤–∞, –Ω–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –∏–∑ —Å—Ç—Ä–æ–∫ –º–∞—Ç—Ä–∏—Ü—ã `U` –Ω–∞ `Œ£`, –∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -- –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤ `V^t` –Ω–∞ `Œ£`. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –∫–∞–∫ –±—ã "–≤–∫–ª–∞–¥—ã–≤–∞–µ–º" (–∞–Ω–≥–ª. embed) —Å–ª–æ–≤–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –µ–¥–∏–Ω–æ–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, —á–∏—Å–ª–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ —á–∏—Å–ª—É —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤. 

–ü–µ—Ä–µ–¥–∞–¥–∏–º –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω—Ü–∏–∏ `widely_svd()`  –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ–≥–æ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏—è. –ß–∏—Å–ª–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π –¥–ª—è —É—Å–µ—á–µ–Ω–Ω–æ–≥–æ SVD –∑–∞–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç `weight_d`: –µ—Å–ª–∏ –∑–∞–¥–∞—Ç—å –µ–º—É –∑–Ω–∞—á–µ–Ω–∏–µ `FALSE`, —Ç–æ –≤–µ—Ä–Ω—É—Ç—Å—è –Ω–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –∞ –º–∞—Ç—Ä–∏—Ü–∞ –ª–µ–≤—ã—Ö —Å–∏–Ω–≥—É–ª—è—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤:

```{r}
word_emb <- news_ppmi |> 
  widely_svd(item1, item2, ppmi,
             weight_d = FALSE, nv = 100) |> 
  rename(word = item1) # –∏–Ω–∞—á–µ nearest_neighbors() –±—É–¥–µ—Ç –∂–∞–ª–æ–≤–∞—Ç—å—Å—è
```

```{r}
word_emb
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ø–∏–∫–æ–≤

–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –≥–ª–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞—à–µ–≥–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. 

```{r}
word_emb |> 
  filter(dimension < 10) |> 
  group_by(dimension) |> 
  top_n(10, abs(value)) |> 
  ungroup() |> 
  mutate(word = reorder_within(word, value, dimension)) |> 
  ggplot(aes(word, value, fill = dimension)) +
  geom_col(alpha = 0.8, show.legend = FALSE) +
  facet_wrap(~dimension, scales = "free_y", ncol = 3) +
  scale_x_reordered() +
  coord_flip() +
  labs(
    x = NULL, 
    y = "Value",
    title = "–ü–µ—Ä–≤—ã–µ 9 –≥–ª–∞–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞ 2019 –≥.",
    subtitle = "–¢–æ–ø-10 —Å–ª–æ–≤"
  ) +
  scale_fill_viridis_c()
```

### –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ—Å–µ–¥–∏

–ò—Å—Å–ª–µ–¥—É–µ–º –Ω–∞—à–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å—á–∏—Ç–∞–µ—Ç –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏. 


```{r}
nearest_neighbors <- function(df, feat, doc=F) {
  inner_f <- function() {
    widely(
        ~ {
          y <- .[rep(feat, nrow(.)), ]
          res <- rowSums(. * y) / 
            (sqrt(rowSums(. ^ 2)) * sqrt(sum(.[feat, ] ^ 2)))
          
          matrix(res, ncol = 1, dimnames = list(x = names(res)))
        },
        sort = TRUE
    )}
  if (doc) {
    df |> inner_f()(doc, dimension, value) }
  else {
    df |> inner_f()(word, dimension, value)
  } |> 
    select(-item2)
}
```


```{r}
word_emb |> 
  nearest_neighbors("—Å–±–æ—Ä–Ω–∞—è")

word_emb |> 
  nearest_neighbors("–∑–∞–≤–æ–¥")
```


### 2D-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Å–ª–æ–≤

```{r}
word_emb_mx <- word_emb  |> 
  cast_sparse(word, dimension, value) |> 
  as.matrix()
```

–î–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º UMAP. –≠—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ–ª–∏–Ω–µ–π–Ω–æ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏.

```{r eval=FALSE}
set.seed(02062024)
viz <- umap(word_emb_mx,  n_neighbors = 15, n_threads = 2)
```

```{r echo=FALSE, eval=FALSE}
save(viz, file = "../data/viz.Rdata")
```

```{r echo=FALSE}
load("../data/viz.Rdata")
```

–ö–∞–∫ –≤–∏–¥–Ω–æ –ø–æ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –º–∞—Ç—Ä–∏—Ü—ã, –≤—Å–µ —Å–ª–æ–≤–∞ –≤–ª–æ–∂–µ–Ω—ã —Ç–µ–ø–µ—Ä—å –≤ –¥–≤—É–º–µ—Ä–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ.

```{r}
dim(viz)
```

:::{.column-page}

```{r fig.width=12}
tibble(word = rownames(word_emb_mx), 
       V1 = viz[, 1], 
       V2 = viz[, 2]) |> 
  ggplot(aes(x = V1, y = V2, label = word)) + 
  geom_text(size = 2, alpha = 0.4, position = position_jitter(width = 0.5, height = 0.5)) +
   annotate(geom = "rect", ymin = 5, ymax = 8, xmin = -1, xmax = 2, alpha = 0.2, color = "tomato")+
  theme_light()
```

:::

–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —ç—Ç–æ–π –∫–∞—Ä—Ç—ã. 

```{r fig.width=9}
tibble(word = rownames(word_emb_mx), 
       V1 = viz[, 1], 
       V2 = viz[, 2]) |> 
  filter(V1 > -1 & V1 < 2) |> 
  filter(V2 > 5 & V2 < 8) |> 
  ggplot(aes(x = V1, y = V2, label = word)) + 
  geom_text(size = 5, alpha = 0.5, 
            position = position_jitter(width = 0.5, height = 0.5)
            ) +
  theme_light()
```

–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ü•ä –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã—Ö –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π. 

## Word2vec

[Word2vec](http://arxiv.org/pdf/1310.4546) -- —ç—Ç–æ –ø–æ–ª–Ω–æ—Å–≤—è–∑–∞–Ω–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å –æ–¥–Ω–∏–º —Å–∫—Ä—ã—Ç—ã–º —Å–ª–æ–µ–º. –¢–∞–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ –≥–ª—É–±–æ–∫–∏–º, –∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–º (shallow).

```{r word2vec}
library(word2vec)

corpus_w2v <- news_tokens_pruned |> 
  group_by(id) |> 
  mutate(text = str_c(token, collapse = " ")) |> 
  distinct(id, text)
```

```{r}
# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–µ—Ä–Ω–æ, —Ç.–∫. –Ω–∞—á–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ
set.seed(02062024) 
model <- word2vec(x = corpus_w2v$text, 
                  type = "skip-gram",
                  dim = 100,
                  window = 10,
                  iter = 20,
                  hs = TRUE,
                  min_count = 5,
                  threads = 6)

```

–ù–∞—à–∞ –º–æ–¥–µ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Å–ª–æ–≤; –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –º–∞—Ç—Ä–∏—Ü—É.

```{r}
emb <- as.matrix(model)
dim(emb)
```

```{r}
predict(model, c("–ø–æ–≥–æ–¥–∞", "—Å–ø–æ—Ä—Ç"), type = "nearest", top_n = 10) |> 
  bind_rows()
```

–ü–æ–ª—É—á–∏–≤—à—É—é—Å—è –º–æ–¥–µ–ª—å –º–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –º—ã —ç—Ç–æ –¥–µ–ª–∞–ª–∏ –≤—ã—à–µ.


## BERT

BERT (Bidirectional Encoder Representations from Transformers) ‚Äî —ç—Ç–æ –≥–ª—É–±–æ–∫–∞—è –Ω–µ–π—Ä–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è Google –≤ 2018 –≥–æ–¥—É. –ì–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å BERT ‚Äî –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ (bidirectional) —á—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–ª–æ–≤–∞ –∫–∞–∫ —Å–ª–µ–≤–∞, —Ç–∞–∫ –∏ —Å–ø—Ä–∞–≤–∞. BERT –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –∑–∞–¥–∞—á–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –∏ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–∏, –∏–¥—É—Ç –ª–∏ –¥–≤–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥.

–í–∞—Ä–∏–∞–Ω—Ç—ã BERT:

- BERT-base (12 —Å–ª–æ–µ–≤), BERT-large (24 —Å–ª–æ—è) ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Ä–∞–∑–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.
- DistilBERT (6 —Å–ª–æ–µ–≤) ‚Äî –æ–±–ª–µ–≥—á—ë–Ω–Ω–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è –≤–µ—Ä—Å–∏—è.
- RoBERTa, ALBERT, TinyBERT –∏ –¥—Ä. ‚Äî —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ BERT, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á.
- Multilingual BERT (mBERT) ‚Äî –¥–ª—è –º–Ω–æ–≥–∏—Ö —è–∑—ã–∫–æ–≤ —Å—Ä–∞–∑—É.


BERT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ ‚Äî —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∏—Ç—ã–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–≤–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É BERT-—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –º–∞—à–∏–Ω–∞–º –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å —Å–º—ã—Å–ª —Ç–µ–∫—Å—Ç–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≤–æ–ø—Ä–æ—Å–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö NLP-–∑–∞–¥–∞—á. 

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø–æ–∏—Å–∫) –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏–∑ RuBERT (–∏–ª–∏ RuRoBERT) –º–æ–¥–µ–ª–µ–π, –æ–Ω–∏ –¥–∞—é—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á–µ–º –∞–Ω–≥–ª–æ—è–∑—ã—á–Ω—ã–µ –∏–ª–∏ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã. 

### Reticulate

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞–º–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è Python. –°–æ–∑–¥–∞–¥–∏–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–∞–∫–µ—Ç–æ–º `{text}`.  


```{r eval=FALSE}
library(reticulate)
use_python("/usr/bin/python3")
```

```{r eval=FALSE}
py_config()
# python:         /usr/bin/python3
# libpython:      /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/config-3.9-darwin/libpython3.9.dylib
# pythonhome:     /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9:/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9
# version:        3.9.6 (default, Feb  3 2024, 15:58:27)  [Clang 15.0.0 (clang-1500.3.9.4)]
# numpy:          /Users/olga/Library/Python/3.9/lib/python/site-packages/numpy
# numpy_version:  1.23.0
# 
# NOTE: Python version was forced by use_python() function
```
```{r eval=FALSE}
py_eval("1+1")
```

–î–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –º–æ–¥—É–ª–∏ `nltk` –∏ `transformers`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –æ–Ω–∏, –∏, –µ—Å–ª–∏ –Ω–∞–¥–æ, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ. 

```{r eval=FALSE}
# –ø—Ä–æ–≤–µ—Ä–∏—Ç—å 
/usr/bin/python3 -c "import nltk; print('nltk version:', nltk.__version__)"
/usr/bin/python3 -c "import transformers; print('transformers version:', transformers.__version__)"
# —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
/usr/bin/python3 -m pip install nltk transformers
```

–°–∫–∞—á–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è NLTK.

```{r eval=FALSE}
py_run_string("
import nltk
nltk.download('punkt')
nltk.download('punkt_tab')
nltk.download('stopwords')
nltk.download('wordnet')
nltk.download('omw-1.4')
")
```


###  –≠–º–±–µ–¥–¥–∏–Ω–≥–∏

–ü–æ–ª—É—á–∞–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å –ø–æ–º–æ—â—å—é `textEmbed()`. –≠—Ç–æ –¥–æ–ª–≥–æ (–¥–ª—è –Ω–∞—à–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –æ–∫–æ–ª–æ –¥–≤—É—Ö —á–∞—Å–æ–≤). –î–ª—è –ø—Ä–æ–±—ã –±–µ—Ä–µ–º –ª–∏—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–≤–æ—Å—Ç–µ–π. 

```{r}
set.seed(18112025)
news_sample <- news_2019 |> 
  filter(topic %in% c("–≠–∫–æ–Ω–æ–º–∏–∫–∞", "–ö—É–ª—å—Ç—É—Ä–∞", "–°–ø–æ—Ä—Ç")) |> 
  sample_n(size = 25)
```

–í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ non-ASCII —Å–∏–º–≤–æ–ª–∞—Ö. –ï—Å–ª–∏ –≤–∞—à–∞ –º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏–ª–∏ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è, —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å. 

```{r eval=FALSE}
emb <- textEmbed(
  texts = news_sample$text,
  # –∏–ª–∏ –¥—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å
  model = "cointegrated/rubert-tiny2",  
  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 
  layers = -2,     
  remove_non_ascii = FALSE
)
```

```{r echo=FALSE, eval=FALSE}
save(emb, file = "../data/emb_bert.Rdata")
```

```{r echo=FALSE}
load("../data/emb_bert.Rdata")
```

–ü–æ–ª—É—á–∞–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤. 313 - —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞.  BERT-—Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç WordPiece —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å–ª–æ–≤–∞ –Ω–∞ —Å—É–±—Ç–æ–∫–µ–Ω—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–µ–¥–∫–∏–µ –∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å–ª–æ–≤–∞.

```{r}
emb$tokens$texts[[2]] 
```

–¢–æ–∫–µ–Ω [CLS] (=classification) ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É–∂–µ–±–Ω—ã–π —Ç–æ–∫–µ–Ω BERT (–∏ –µ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π), –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

```{r}
emb$texts$texts
```

### 2D-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏


```{r}
emb_texts <- emb$texts$texts  |> 
  mutate(text_id = news_sample$id) |> 
  mutate(topic = news_sample$topic)

umap_res <- emb_texts |> 
  dplyr::select(-text_id, -topic) |> 
  as.matrix() |> 
  umap(n_neighbors = 15, min_dist = 0.1, metric = "cosine")

plot_df <- as.data.frame(umap_res) |> 
  setNames(c("UMAP1", "UMAP2")) |> 
  mutate(text_id = emb_texts$text_id, 
         topic = emb_texts$topic)

plot_df |> 
  ggplot(aes(UMAP1, UMAP2, color = topic)) +
  geom_text(aes(label = text_id), alpha = 0.8, size = 3) +
  theme_minimal()
```

Doc2672 —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–≤–æ—Å—Ç—å –æ –¥–æ—á–µ—Ä–∏ –∞–∫—Ç–µ—Ä–∞, –∞ doc519 -- –æ —Ä–µ–π—Ç–∏–Ω–≥–µ —Å–∞–º—ã—Ö –≤—ã—Å–æ–∫–æ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã—Ö –∏–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç–æ–≤.

### –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ—Å–µ–¥–∏

```{r}
nearest_neighbors_matrix <- function(df, feat_row) {
  # df: –¥–∞—Ç–∞—Ñ—Ä–µ–π–º –∏–ª–∏ –º–∞—Ç—Ä–∏—Ü–∞, –≤ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ —ç–º–±–µ–¥–¥–∏–Ω–≥
  # feat_row: –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏/–∏–º—è —Å—Ç—Ä–æ–∫–∏, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –∏—â–µ–º —Å–æ—Å–µ–¥–∞
  m <- as.matrix(df)
  
  # –≤–µ–∫—Ç–æ—Ä-—ç–º–±–µ–¥–¥–∏–Ω–≥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
  v <- m[feat_row, ]
  
  # –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
  similarities <- (m %*% v) / (sqrt(rowSums(m^2)) * sqrt(sum(v^2)))
  
  # —Å–∞–º–æ–≥–æ —Å–µ–±—è –Ω–µ –±–µ—Ä—ë–º
  similarities[feat_row] <- -Inf
  
  # –±–ª–∏–∂–∞–π—à–∏–π ‚Äì –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
  nn_idx <- which.max(similarities)
  
  # –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  list(
    index = nn_idx,
    similarity = similarities[nn_idx]
  )
}
```

```{r}
nn <- nearest_neighbors_matrix(df = emb_texts %>% dplyr::select(-text_id, -topic), feat_row = 5)

nn
```

```{r}
news_sample |> 
  filter(row_number() == 5) |> 
  pull(text)
```
```{r}
news_sample |> 
  filter(row_number() == nn$index) |> 
  pull(text)
```

