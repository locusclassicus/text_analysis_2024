# –í–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥

–§–∞–π–ª—ã html, –∫–∞–∫ –∏ XML, —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –ò–∑–≤–ª–µ—á—å –∏—Ö –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞–∫–µ—Ç `rvest`. –° –µ–≥–æ –ø–æ–º–æ—â—å—é –º—ã –¥–æ–±—É–¥–µ–º –∞—Ä—Ö–∏–≤ —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª–∞ Antibarbari HSE. –ö–∞–Ω–∞–ª –ø—É–±–ª–∏—á–Ω—ã–π, –∏ Telegram –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ html –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–Ω–æ–ø–∫–∏ export (—ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ MacOS, –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å [Telegram Lite](https://apps.apple.com/us/app/telegram-lite/id946399090)). –î–∞–Ω–Ω—ã–µ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ zip) –¥–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å [–ø–æ —Å—Å—ã–ª–∫–µ](https://github.com/locusclassicus/text_analysis_2024/raw/refs/heads/main/files/antibarbari_2024-08-18.zip).

–≠—Ç–∞ –≥–ª–∞–≤–∞ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–æ–º –Ω–∞ [–≤—Ç–æ—Ä–æ–µ –∏–∑–¥–∞–Ω–∏–µ](https://r4ds.hadley.nz/webscraping.html) –∫–Ω–∏–≥–∏ R for Data Science –•–∞–¥–ª–∏ –í–∏–∫—Ö–µ–º–∞.

```{r message=FALSE}
library(rvest)
library(tidyverse)
library(polite)
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ html 

–î–æ–∫—É–º–µ–Ω—Ç—ã html (HyperText Markup Language) –∏–º–µ—é—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Å–æ—Å—Ç–æ—è—â—É—é –∏–∑ _—ç–ª–µ–º–µ–Ω—Ç–æ–≤_.  –í –∫–∞–∂–¥–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –µ—Å—Ç—å _–æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥_ (`<tag>`), –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ _–∞—Ç—Ä–∏–±—É—Ç—ã_ (`id='first'`) –∏ _–∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥_ (`</tag>`). –í—Å–µ, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–µ–∂–¥—É –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–º –∏ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º, –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è _—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º_ —ç–ª–µ–º–µ–Ω—Ç–∞. 

–í–∞–∂–Ω–µ–π—à–∏–µ —Ç–µ–≥–∏, –æ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ–∏—Ç –∑–Ω–∞—Ç—å:

- `<html>` (–µ—Å—Ç—å –≤—Å–µ–≥–¥–∞), —Å –¥–≤—É–º—è –¥–µ—Ç—å–º–∏ (–¥–æ—á–µ—Ä–Ω–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏): `<head>` –∏ `<body>`;
- —ç–ª–µ–º–µ–Ω—Ç—ã, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É: `<h1>` (–∑–∞–≥–æ–ª–æ–≤–æ–∫), `<section>`, `<p>` (–ø–∞—Ä–∞–≥—Ä–∞—Ñ), `<ol>` (—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫);
- —ç–ª–µ–º–µ–Ω—Ç—ã, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: `<b>` (bold), `<i>` (italics), `<a>` (—Å—Å—ã–ª–∫–∞).

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–∞–¥–æ –Ω–∞–∂–∞—Ç—å –ø—Ä–∞–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –∏ –≤—ã–±—Ä–∞—Ç—å `View Source` (—ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è —Ç–µ—Ö html, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —É –≤–∞—Å –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ).


## –ö–∞—Å–∫–∞–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∏–ª–µ–π

–£ —Ç–µ–≥–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã; –≤–∞–∂–Ω–µ–π—à–∏–µ –∏–∑ –Ω–∏—Ö -- —ç—Ç–æ `id` –∏ `class`, –∫–æ—Ç–æ—Ä—ã–µ –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å CSS –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

:::{.callout-note icon=false}
CSS (–∞–Ω–≥–ª. Cascading Style Sheets ¬´–∫–∞—Å–∫–∞–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∏–ª–µ–π¬ª) ‚Äî —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —è–∑—ã–∫ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã), –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ —Ä–∞–∑–º–µ—Ç–∫–∏ (—á–∞—â–µ –≤—Å–µ–≥–æ HTML –∏–ª–∏ XHTML).
:::

–ü—Ä–∏–º–µ—Ä css-–ø—Ä–∞–≤–∏–ª–∞ (—Ç–∞–∫–∏–µ –∏–Ω—Ñ–æ–±–æ–∫—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ [–ø—Ä–µ–¥—ã–¥—É—â–µ–π](https://locusclassicus.github.io/text_analysis_2023/%D0%B2%D0%B5%D0%B1-%D1%81%D0%BA%D1%80%D0%B0%D0%BF%D0%B8%D0%BD%D0%B3.html#%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-html) –≤–µ—Ä—Å–∏–∏ –∫—É—Ä—Å–∞):

```{css}
.infobox {
  padding: 1em 1em 1em 4em;
  background: aliceblue 5px center/3em no-repeat;
  color: black;
}
```

–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ç–µ–º –∏–ª–∏ –∏–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º. –ö–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ CSS –∏–º–µ–µ—Ç –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —á–∞—Å—Ç–∏ ‚Äî _—Å–µ–ª–µ–∫—Ç–æ—Ä_ –∏ _–±–ª–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π_. –°–µ–ª–µ–∫—Ç–æ—Ä, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–π –≤ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ –∑–Ω–∞–∫–∞ `{`, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω–∞ –∫–∞–∫–∏–µ —á–∞—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—ã–µ) —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ. –ë–ª–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞. –û–Ω –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏, –∏, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –±–æ–ª–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–Ω–∞–∫–æ–º ¬´;¬ª.

–°–µ–ª–µ–∫—Ç–æ—Ä—ã CSS –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è —Å–∫—Ä–∞–ø–∏–Ω–≥–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç –≤—ã—á–ª–µ–Ω–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

- `p` –≤—ã–±–µ—Ä–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã \<p\>
- `.title` –≤—ã–±–µ—Ä–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–æ–º "title"
- `#title` –≤—ã–±–µ—Ä–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º id='title'

–í–∞–∂–Ω–æ: –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –æ—Ç–∫—É–¥–∞ –≤—ã —Å–∫—Ä–∞–ø–∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —Ç–æ –∏ –∫–æ–¥ –ø—Ä–∏–¥–µ—Ç—Å—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å.

## –ß—Ç–µ–Ω–∏–µ html

–ß—Ç–æ–±—ã –ø—Ä–æ—á–µ—Å—Ç—å —Ñ–∞–π–ª html, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–Ω–æ–∏–º–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é (–∏ –ø–∞–∫–µ—Ç `purrr`, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ä–∞–∑—É —Ç—Ä–∏ —Ñ–∞–π–ª–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞).

```{r message=FALSE}
antibarbari_files <- list.files("../files/antibarbari_2024-08-18", pattern = "html", full.names = TRUE)
antibarbari_archive <- map(antibarbari_files, read_html)
```

## –ü–∞—Ä—Å–∏–Ω–≥ html: –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

–ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —è —Å–æ—Ö—Ä–∞–Ω—é —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∫ –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π html; `rvest` –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å (–Ω–æ –≤–Ω—É—Ç—Ä–∏ –¥–≤–æ–π–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ):

```{r}
example_html <-  minimal_html("
<div class='message default clearfix' id='message83'>
      <div class='pull_left userpic_wrap'>
       <div class='userpic userpic2' style='width: 42px; height: 42px'>
        <div class='initials' style='line-height: 42px'>
A
        </div>
       </div>
      </div>
      <div class='body'>
       <div class='pull_right date details' title='19.05.2022 11:18:07 UTC+03:00'>
11:18
       </div>
       <div class='from_name'>
Antibarbari HSE 
       </div>
       <div class='text'>
–≠—Ç–æ—Ç –ø–æ—Å—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Ä–∏—é –ø–µ—Ä–µ–ª–æ–∂–µ–Ω–∏–π –∏–∑ ¬´–î–∞–π–¥–∂–µ—Å—Ç–∞ –ø–ª–∞—Ç–æ–Ω–æ–≤—Å–∫–∏—Ö –∏–¥–∏–æ–º¬ª –î–∂–µ–π–º—Å–∞ –†–∏–¥–¥–µ–ª–ª–∞ (1823‚Äì1866), –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —Ñ–∏–ª–æ–ª–æ–≥–∞-–∫–ª–∞—Å—Å–∏–∫–∞, —á–µ–π –Ω–∞—É—á–Ω—ã–π –ø—É—Ç—å –±—ã–ª —Å–≤—è–∑–∞–Ω —Å –û–∫—Å—Ñ–æ—Ä–¥—Å–∫–∏–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–º. –ü–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é –ë–µ–Ω–¥–∂–∞–º–∏–Ω–∞ –î–∂–æ–≤–µ—Ç—Ç–∞ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã–ª –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ –∏–∑–¥–∞–Ω–∏—é ¬´–ê–ø–æ–ª–æ–≥–∏—é¬ª, ¬´–ö—Ä–∏—Ç–æ–Ω¬ª, ¬´–§–µ–¥–æ–Ω¬ª –∏ ¬´–ü–∏—Ä¬ª. –û–¥–Ω–∞–∫–æ –∏–∑ —ç—Ç–∏—Ö —á–µ—Ç—ã—Ä–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤ –≤—ã—à–ª–∞ –ª–∏—à—å ¬´–ê–ø–æ–ª–æ–≥–∏—è¬ª —Å –ø—Ä–µ–¥–∏—Å–ª–æ–≤–∏–µ–º –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –≤ –≤–∏–¥–µ ¬´–î–∞–π–¥–∂–µ—Å—Ç–∞¬ª (—Å—Å—ã–ª–∫–∞) ‚Äî —É–∂–µ –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏ –∞–≤—Ç–æ—Ä–∞. <br><br>¬´–î–∞–π–¥–∂–µ—Å—Ç¬ª —Å–æ–¥–µ—Ä–∂–∏—Ç 326 –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤, –ø–æ—Å–≤—è—â–µ–Ω–Ω—ã—Ö –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–º, —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–º –∏ —Ä–∏—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º —è–∑—ã–∫–∞ –ü–ª–∞—Ç–æ–Ω–∞. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å —ç—Ç–∏–º —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª—É—á—à–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Ñ–∏–ª–æ—Å–æ—Ñ–∞ –∏ –¥–æ–±–∏—Ç—å—Å—è –±–æ–ª—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ. –°—Å—ã–ª–∫–∏ –Ω–∞ ¬´–î–∞–π–¥–∂–µ—Å—Ç¬ª –º–æ–≥—É—Ç –±—ã—Ç—å —É–º–µ—Å—Ç–Ω—ã –∏ –≤ —É—á–µ–±–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –¥–∏–∞–ª–æ–≥–∞–º –ü–ª–∞—Ç–æ–Ω–∞. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∑–¥–µ—Å—å –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å ¬´–î–∞–π–¥–∂–µ—Å—Ç–∞¬ª —Å–æ–¥–µ—Ä–∂–∏—Ç ¬´–∏–¥–∏–æ–º—ã –∏–º–µ–Ω¬ª –∏ ¬´–∏–¥–∏–æ–º—ã –∞—Ä—Ç–∏–∫–ª—è¬ª (¬ß¬ß 1‚Äì39).<br><a href='http://antibarbari.ru/2022/05/19/digest_1/'>http://antibarbari.ru/2022/05/19/digest_1/</a>
       </div>
       <div class='signature details'>
Olga Alieva
       </div>
      </div>
     </div>
")
```

–ò–∑ –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ –º–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ id —Å–æ–æ–±—â–µ–Ω–∏—è (`\<div class='message default clearfix' id='message83'\>`), —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (`\<div class='text'\>`), –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (`\<div class='pull_right date details' title='19.05.2022 11:18:07 UTC+03:00'\>`), –∞ —Ç–∞–∫–∂–µ, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –∞–≤—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è (`\<div class='signature details'\>`). –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç (–¥–ª—è —ç—Ç–æ–≥–æ [—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è](https://r4ds.hadley.nz/webscraping.html#fn6) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `html_text2()`):

```{r}
example_html |>
  html_element(".text") |> 
  html_text2()
```

–í –∫–ª–∞—Å—Å–µ `signature details` –µ—Å—Ç—å –ø—Ä–æ–±–µ–ª, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞ –µ–≥–æ –º–µ—Å—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ—á–∫—É:

```{r}
example_html |>
  html_element(".signature.details") |> 
  html_text2()
```

–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±—ã—Ç—å –¥–∞—Ç—É –∏ message id:

```{r}
example_html |> 
  html_element(".pull_right.date.details") |> 
  html_attr("title")
```

```{r}
example_html |>
  html_element(".message.default.clearfix") |>
  html_attr("id")
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É.

```{r message=FALSE}

tibble(id = example_html |> 
         html_element(".message.default.clearfix") |> 
         html_attr("id"),
       date = example_html |> 
         html_element(".pull_right.date.details") |> 
         html_attr("title"),
       signature = example_html |>
         html_element(".signature.details") |> 
         html_text2(),
       text = example_html |> 
         html_element(".text") |>
         html_text2()
)
```

## –ü–∞—Ä—Å–∏–Ω–≥ html: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

–î–æ —Å–∏—Ö –ø–æ—Ä –Ω–∞—à–∞ –∑–∞–¥–∞—á–∞ —É–ø—Ä–æ—â–∞–ª–∞—Å—å —Ç–µ–º, —á—Ç–æ –º—ã –∏–º–µ–ª–∏ –¥–µ–ª–æ —Å –∏–≥—Ä—É—à–µ—á–Ω—ã–º html –¥–ª—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –í –Ω–∞—Å—Ç–æ—è—â–µ–º html —Ç–µ–≥ `div` –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö, –∏ –Ω–∞–º –Ω–∞–¥–æ –∏–∑–≤–ª–µ—á—å —Ç–æ–ª—å–∫–æ —Ç–∞–∫–∏–µ `div`, –∫–æ—Ç–æ—Ä—ã–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å. –¢–∞–∫–∂–µ –Ω–µ –±—É–¥–µ–º –∑–∞–±—ã–≤–∞—Ç—å, —á—Ç–æ –∞—Ä—Ö–∏–≤ –≤—ã–≥—Ä—É–∑–∏–ª—Å—è –≤ –≤–∏–¥–µ —Ç—Ä–µ—Ö html-—Ñ–∞–π–ª–æ–≤, —Ç–∞–∫ —á—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–∞—à–µ –∑–Ω–∞–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–π –≤ `purrr`. –ü–æ–∫–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ –Ω–∏—Ö:

```{r}
archive_1 <- antibarbari_archive[[1]]

archive_1 |>
  html_elements("div.message.default") |> 
  head()
```

–£–∂–µ –∏–∑ —ç—Ç–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —É–∑–ª–æ–≤ –º–æ–∂–µ–º –¥–æ—Å—Ç–∞–≤–∞—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ. 

```{r}
archive_1_tbl <- tibble(
  id = archive_1 |>
    html_elements("div.message.default") |>
    html_attr("id"),
  
  date = archive_1 |>
    html_elements("div.message.default") |>
    html_element(".pull_right.date.details") |>
    html_attr("title"),
  
  signature = archive_1 |>
    html_elements("div.message.default") |>
    html_element(".signature.details") |>
    html_text2(),
  
  text = archive_1 |>
    html_elements("div.message.default") |>
    html_element(".text") |>
    html_text2()
)

archive_1_tbl
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –º—ã —Å–Ω–∞—á–∞–ª–∞ –∏–∑–≤–ª–µ–∫–∞–µ–º –Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ `html_elements()`, –∞ –ø–æ—Ç–æ–º –ø—Ä–∏–º–µ–Ω—è–µ–º –∫ –∫–∞–∂–¥–æ–º—É –∏–∑ –Ω–∏—Ö `html_element()`. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ –Ω–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–≤–Ω–æ–µ —á–∏—Å–ª–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π.

–ö–∞–∫ –≤—ã —É–∂–µ –ø–æ–Ω—è–ª–∏, —Ç–µ–ø–µ—Ä—å –Ω–∞–º –Ω–∞–¥–æ –ø—Ä–æ–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è –¥–≤—É—Ö –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –∞—Ä—Ö–∏–≤–∞ –∞–Ω—Ç–∏–≤–∞—Ä–≤–∞—Ä–æ–≤, –∞ –∑–Ω–∞—á–∏—Ç –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –Ω–∞—à –∫–æ–¥ –≤ —Ñ—É–Ω–∫—Ü–∏—é.

```{r eval=FALSE}
scrape_antibarbari <- function(html_file){
  messages_tbl <- tibble(
    id = html_file |>
      html_elements("div.message.default") |>
      html_attr("id"),
    date = html_file |>
      html_elements("div.message.default") |>
      html_element(".pull_right.date.details") |>
      html_attr("title"),
    signature = html_file |>
      html_elements("div.message.default") |>
      html_element(".signature.details") |>
      html_text2(),
    text = html_file |>
      html_elements("div.message.default") |>
      html_element(".text") |>
      html_text2()
  )
  messages_tbl
}


messages_tbl <- map_df(antibarbari_archive, scrape_antibarbari)
```

```{r echo=FALSE}
#save(messages_tbl, file = "../data/messages_tbl.RData")
load("../data/messages_tbl.RData")
```

–í–æ—Ç —á—Ç–æ —É –Ω–∞—Å –ø–æ–ª—É—á–∏–ª–æ—Å—å.

```{r}
messages_tbl
```

## –†–∞–∑–≤–µ–¥—ã–≤–∞—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

–°–æ–∑–¥–∞—Ç–µ–ª–∏ –∫–∞–Ω–∞–ª–∞ –Ω–µ —Å—Ä–∞–∑—É —Ä–∞–∑—Ä–µ—à–∏–ª–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å—Ç—ã, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –ø–µ—Ä–≤—ã—Ö –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–µ—Å—è—Ç–∫–æ–≤ –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –±—É–¥–µ—Ç. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ—Å—Ç–∞—Ö —Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ, –¥–ª—è –Ω–∏—Ö –≤ —Å—Ç–æ–ª–±—Ü–µ text -- NA, –∏—Ö –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –æ—Ç—Å–µ—è—Ç—å.

```{r}
messages_tbl <- messages_tbl |>
  filter(!is.na(text))

messages_tbl
```

–¢–∞–∫–∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç–æ–ª–±–µ—Ü, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è. –†–∞–∑–¥–µ–ª–∏–º –µ–≥–æ –Ω–∞ –¥–≤–∞ –∏ –≤—ã—è—Å–Ω–∏–º, –≤ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è.

:::{.callout-warning icon=false}
–ò–∑ –∫—É—Ä—Å–∞ `Getting and Cleaning Data` –≤ swirl –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–æ–π—Ç–∏ —É—Ä–æ–∫ `Dates and Times with lubridate`. 
:::


```{r}
messages_tbl2 <- messages_tbl |> 
  separate(date, into = c("date", "time", NA), sep = " ") |> 
  mutate(date = dmy(date), 
         time = hms(time)) |> 
  mutate(year = year(date), 
        month = month(date, label = TRUE),
        wday = wday(date, label = TRUE),
        hour = hour(time),
        length = str_count(text, " ") + 1) |> 
  mutate(wday = factor(wday, levels = c("Sun", "Sat", "Fri", "Thu", "Wed", "Tue", "Mon")))


messages_tbl2
```

```{r message=FALSE}
summary1 <- messages_tbl2 |> 
  group_by(year, month) |> 
  summarise(n = n()) 

summary1

summary2 <- messages_tbl2 |> 
  group_by(year, hour) |> 
  summarise(n = n()) |> 
  mutate(hour = case_when(hour == 0 ~ 24,
                          .default = hour))

summary2

summary3 <- messages_tbl2 |> 
   group_by(wday) |> 
   summarise(n = n())

summary3
```
```{r message=FALSE, warning=FALSE}
library(gridExtra)
library(grid)
library(paletteer)
cols <- paletteer_d("khroma::okabeitoblack")

p1 <- summary1 |> 
  ggplot(aes(month, n, color = as.factor(year), group = year)) +
  geom_line(show.legend = FALSE, linewidth = 1.2, alpha = 0.8) +
  labs(title = "–ß–∏—Å–ª–æ –ø–æ—Å—Ç–æ–≤ –≤ –º–µ—Å—è—Ü") +
  theme(legend.title = element_blank(), 
        legend.position = c(0.8, 0.3),
        title = element_text(face="italic")) +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = cols[1:3])


p2 <- summary2 |> 
  ggplot(aes(hour, n, color = as.factor(year), group = year)) + 
  geom_line(linewidth = 1.2, alpha = 0.8) +
  scale_x_continuous(breaks = seq(1,24,1)) +
  labs(x = NULL, y = NULL, title = "–í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞") + 
  theme(legend.title = element_blank(), 
        legend.position = "left",
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        title = element_text(face="italic")
        ) +
  coord_polar(start = 0) +
  scale_color_manual(values = cols[1:3])


p3 <- summary3 |> 
  ggplot(aes(wday, n, fill = wday)) + 
  geom_bar(stat = "identity", 
           show.legend = FALSE) + 
  coord_flip() + 
  labs(x = NULL, y = NULL, title  = "–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏") +
  scale_fill_manual(values = cols) +
  theme(title = element_text(face="italic"))


p4 <- messages_tbl2 |> 
  ggplot(aes(as.factor(year), length, fill = as.factor(year))) +
  geom_boxplot(show.legend = FALSE) +
  labs(title = "–î–ª–∏–Ω–∞ –ø–æ—Å—Ç–∞ –ø–æ –≥–æ–¥–∞–º") + 
  labs(x = NULL, y = NULL) + 
  scale_fill_manual(values = cols[1:3]) + 
  theme(title = element_text(face="italic"))


grid.arrange(p1, p2, p3, p4, nrow = 2,
             top =  textGrob("–¢–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª Antibarbari HSE",
                    gp=gpar(fontsize=16)),
             bottom = textGrob("@Rantiquity",
                    gp = gpar(fontface = 3, fontsize = 9), hjust = 1, x = 1)) 
```

## Html —Ç–∞–±–ª–∏—Ü—ã

–ï—Å–ª–∏ –≤–∞–º –ø–æ–≤–µ–∑–µ—Ç, —Ç–æ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ HTML-—Ç–∞–±–ª–∏—Ü–µ, –∏ –∏—Ö –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞—Ç—å [–∏–∑ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã](https://r4ds.hadley.nz/webscraping#tables). –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ –æ–±—ã—á–Ω–æ –Ω–µ—Å–ª–æ–∂–Ω–æ: –æ–Ω–∞ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤, –∏ –µ–µ –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–∞–∫ Excel.

–¢–∞–±–ª–∏—Ü—ã HTML —Å—Ç—Ä–æ—è—Ç—Å—è –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: `<table>`, `<tr>` (—Å—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã), `<th>` (–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã) –∏ `<td>` (–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã).  –ú—ã –¥–æ—Å—Ç–∞–Ω–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É –∫—É—Ä—Å–∞ "–ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã—Ö –Ω–∞—É–∫–∞—Ö: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ" (2023/2024).

```{r}
html <- read_html("http://criticaldh.ru/program/")
my_table <- html |>  
  html_table() |> 
  pluck(1)

my_table
```


:::{.callout-warning icon=false}
–° —Å–∞–π—Ç–∞ [–ù–æ–≤–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–π —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏](https://iphlib.ru/library/collection/newphilenc/browse/CL1/21) –∏–∑–≤–ª–µ–∫–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –Ω–∞ –±—É–∫–≤—É –ü. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `map_df()` –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü.
:::


:::{.callout-tip icon=false}
–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Å–ª–æ–≤ –Ω–∞ –±—É–∫–≤—É –ü –≤ –ù–§–≠?
:::

```{r echo=FALSE, results='asis'}
library(checkdown)
check_question("267", right = "–ü–ü–ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ", wrong =  "–ü–ü–æ–¥—É–º–∞–π—Ç–µ –µ—â–µ ‚ùå")
```


## Selector Gadget

–ú–Ω–æ–≥–∏–µ —Ç–µ–∫—Å—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ <wikisource.org>. –ü–æ–ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –ª–∞—Ç–∏–Ω—Å–∫–∏–π —Ç–µ–∫—Å—Ç "–ó–∞–ø–∏—Å–æ–∫ –æ –ì–∞–ª–ª—å—Å–∫–æ–π –≤–æ–π–Ω–µ" –¶–µ–∑–∞—Ä—è: –æ–Ω –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –Ω–∞–º –≤ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ. 

```{r}

url <- "https://la.wikisource.org/wiki/Commentarii_de_bello_Gallico"
html = read_html(url)
```

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å —Ç–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π, –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è Selector Gadget (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è Chrome). –í–æ—Ç [—Ç—É—Ç](https://youtu.be/oqNTfWrGdbk) –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ, –∫–∞–∫ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. –ü—Ä–∏ –ø–æ–º–æ—â–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—ã–µ —É—Ä–æ–≤–Ω–∏.

```{r warning=FALSE}
toc <- html |> 
  html_elements("#mw-content-text li") 

toc
```

–ò–∑–≤–ª–µ–∫–∞–µ–º –ø—É—Ç—å –∏ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è web-—Å—Ç—Ä–∞–Ω–∏—Ü.

```{r}
libri <- tibble(
  title = toc |> 
    html_text2(),
  href = toc |> 
    html_element("a") |> 
    html_attr("href")
) 

libri
```

–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–æ—Å—Ç—É–ø–∞ –∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

```{r}
libri <- libri |> 
  mutate(link = str_c("https://la.wikisource.org", href)) |> 
  select(-href)

libri
```

–î–∞–ª—å—à–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ—Å—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏. –ü–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è –Ω–∞ –æ–¥–Ω–æ–π. –°–Ω–æ–≤–∞ –ø—Ä–∏–≤–ª–µ–∫–∞–µ–º Selector Gadget –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞.

```{r}
urls <- libri |> 
  pull(link)

text <- read_html(urls[1]) |> 
  html_elements(".mw-heading3+ p") |> 
  html_text2() 

text[1]
```

–£–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã –∏–∑–≤–ª–µ—á–µ–Ω—ã –≤–µ—Ä–Ω–æ, –æ–±–æ–±—â–∞–µ–º: –ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–µ –∫–æ –≤—Å–µ–º –∫–Ω–∏–≥–∞–º.

```{r}
get_text <- function(url) {
  Sys.sleep(3)
  res = tibble(
    liber = str_extract(url, "Liber_.+$"),
    text = read_html(url) |>
      html_elements(".mw-heading3+ p") |>
      html_text2())
  return(res)
}
```

–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.

```{r eval=FALSE}
libri_text <- map_df(urls, get_text)
```

–°–æ–µ–¥–∏–Ω–∏–º –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã. 

```{r eval=FALSE}
caesar <- libri_text |> 
  group_by(liber) |> 
  mutate(cap = row_number(), .after = liber)

caesar
```

–°–æ—Ö—Ä–∞–Ω–∏–º –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. 

```{r eval=FALSE}
save(caesar, file = "../data/caesar.Rdata")
```


## –°–µ—Ç–µ–≤–∞—è –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å


–ö–æ–≥–¥–∞ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –≤–µ–±-—Å–∞–π—Ç–∞–º–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü, –≤–∞–∂–Ω–æ:

- –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä (–±—ã—Å—Ç—Ä—ã–µ, —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å—Ü–µ–Ω–µ–Ω—ã –∫–∞–∫ –∞—Ç–∞–∫–∞ –∏–ª–∏ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –±–∞–Ω—É).
- —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ robots.txt ‚Äî¬†–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–æ—Ç–∞–º–∏.
- —É–≤–∞–∂–∞—Ç—å —Å–∞–π—Ç: –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.

`polite` –ø–æ–º–æ–≥–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª: 

- `bow()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç robots.txt –∏ –∑–∞–≤–æ–¥–∏—Ç "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä", –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ,
- `nod()` ‚Äî –≥–æ—Ç–æ–≤–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- `scrape()` ‚Äî —Å–∫–∞—á–∏–≤–∞–µ—Ç html-—Å—Ç—Ä–∞–Ω–∏—Ü—É, –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞.


```{r}
# —Ä–∞—Å–∫–ª–∞–Ω–∏–≤–∞–µ–º—Å—è
url <- "https://la.wikisource.org/wiki/Commentarii_de_bello_Gallico"
session <- bow(url)

# –∑–∞–≥—Ä—É–∂–∞–µ–º HTML –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–∞ —Å –ø–æ–º–æ—â—å—é polite
html <- scrape(session)
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å –ø–æ–º–æ—â—å—é Selector Gadget –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è, –∫–∞–∫ —Ä–∞–Ω—å—à–µ. 

```{r}
toc <- html |> 
   html_elements("#mw-content-text li")

toc
```
–ü–æ–ª—É—á–∏–≤ —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.

```{r}
# —Ä–∞—Å–∫–ª–∞–Ω–∏–≤–∞–µ–º—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π
get_text_polite <- function(url) {
  bow_obj <- bow(url)
  html_page <- scrape(bow_obj)
  res = tibble(
    liber = str_extract(url, "Liber_.+$"),
    text = html_page |>
      html_elements(".mw-heading3+ p") |>
      html_text2())
  return(res)
}
```

–ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç—ã –∫–æ –≤—Å–µ–º –≥–ª–∞–≤–∞–º —Å –ø–æ–º–æ—â—å—é `map()`.

```{r eval=FALSE}
# polite –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—É—é –ø–∞—É–∑—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
libri_text <- map_df(urls, get_text_polite)
```

–ò—Ç–æ–≥–æ:

- `bow(url)` ‚Äî¬†—Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω—É—é —Å–µ—Å—Å–∏—é —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º robots.txt.
- `scrape()` ‚Äî¬†–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–∑–≤–æ–ª–µ–Ω–æ.
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `get_text_polite` –∫–∞–∂–¥–æ–º—É URL —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–≤–æ—è `bow()`-—Å–µ—Å—Å–∏—è.
–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.


## –í–∏–¥–µ–æ

- [–í–∏–¥–µ–æ](https://vkvideo.ru/video91786643_456239048) 2024 –≥.
- [–í–∏–¥–µ–æ](https://vk.com/video91786643_456239084) 2025 –≥.

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

üîó –ó–∞–¥–∞–Ω–∏–µ –≤ Classroom: <https://classroom.github.com/a/svdMrfyd>


‚åõ –î–µ–¥–ª–∞–π–Ω: 23/11, –≤—Ä–µ–º—è 23:59


‚úÖ –û—Ü–µ–Ω–∫–∞ 0/1

–ü–æ —Å—Å—ã–ª–∫–µ –≤—ã –Ω–∞–π–¥–µ—Ç–µ –ø—É—Å—Ç–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –í–∞–º –Ω–∞–¥–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∑–∞–ø–∞—Ä—Å–∏—Ç—å _–ª—é–±–æ–π —Å–∞–π—Ç_ –∏ –ø–æ–ª–æ–∂–∏—Ç—å —Ç—É–¥–∞ —Ñ–∞–π–ª —Å –∫–æ–¥–æ–º. –ï—Å–ª–∏ –≤—ã –ø–∞—Ä—Å–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é html-—Å—Ç—Ä–∞–Ω–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—Ä—Ö–∏–≤ –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–∞–Ω–∞–ª–∞), –µ–µ —Å–ª–µ–¥—É–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º. 

–ó–∞–¥–∞–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º, –µ—Å–ª–∏:

- [ ] –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–∞–∫–µ—Ç `{rvest}` –∏ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã —Å–µ–ª–µ–∫—Ç–æ—Ä—ã css;
- [ ] –Ω–∞ –≤—ã—Ö–æ–¥–µ —Ç–∞–±–ª–∏—Ü–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `title/id`, `stable_url`, `text`, `rating`);
- [ ] —Å—Å—ã–ª–∫–∏ —Å–æ–±—Ä–∞–Ω—ã –Ω–µ –≤—Ä—É—á–Ω—É—é, –∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π);
- [ ] –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã –∏—Ç–µ—Ä–∞—Ü–∏–∏ (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ `map_()`);
- [ ] –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω —Å–∫—Ä–∏–Ω—à–æ—Ç —Å –∫—É—Å–æ—á–∫–æ–º —Ç–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä–∞—è —É –≤–∞—Å –ø–æ–ª—É—á–∏–ª–∞—Å—å;
- [ ] –∫–æ–¥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–∫–∏; –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–ª—é—Å -- –≤–Ω—è—Ç–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, –ø–æ—è—Å–Ω—è—é—â–∏–µ, —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç;
- [ ] –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç `{polite}` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
 
–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å —Å–æ—Ç–Ω–∏ —Å—Å—ã–ª–æ–∫, –∏—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å 10-15, –Ω–æ —è –¥–æ–ª–∂–Ω–∞ –≤–∏–¥–µ—Ç—å, —á—Ç–æ –≤—ã –æ—Å–≤–æ–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª, —Ç–æ –µ—Å—Ç—å –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç–µ –∫–æ–ø–∏–ø–∞—Å—Ç—É. 

–ö–∞–∫–∏–µ —ç—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

- –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤: –í–∏–∫–∏—Ç–µ–∫–∞, lib.ru,  –¥—Ä. –ö—Ä–æ–º–µ —Ä—É—Å—Å–∫–æ–≥–æ, –º–æ–∂–µ—Ç–µ –≤–∑—è—Ç—å –ª—é–±–æ–π –∑–Ω–∞–∫–æ–º—ã–π –≤–∞–º –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π —è–∑—ã–∫, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–∞—Ç–∏–Ω–∏—Ü—É (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π, —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, –Ω–µ–º–µ—Ü–∫–∏–π, –∏—Å–ø–∞–Ω—Å–∫–∏–π, –∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π);
- –æ–Ω–ª–∞–π–Ω-–∏–∑–¥–∞–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∏–ª–∏ –ø—Ä–æ—Å–≤–µ—Ç–∏—Ç–µ–ª—å—Å–∫–∏–µ;
- –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏, –≤ —Ç.—á. –í–∏–∫–∏–ø–µ–¥–∏—è, –ù–æ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –∏ –¥—Ä. –° –ù–≠–§ –º—ã –Ω–µ–º–Ω–æ–≥–æ –ø–æ—Ä–∞–±–æ—Ç–∞–ª–∏, –Ω–æ —Å—Ç–∞—Ç—å–∏ –æ—Ç—Ç—É–¥–∞ –Ω–µ –∏–∑–≤–ª–µ–∫–∞–ª–∏, —Ç–∞–∫ —á—Ç–æ –µ–µ —Ç–æ–∂–µ –º–æ–∂–Ω–æ;
- —Å–∞–π—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π: —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤, –±–∏–±–ª–∏–æ—Ç–µ–∫, –º—É–∑–µ–µ–≤ –∏ —Ç.–¥.;
- –Ω–∞—É—á–Ω—ã–µ –∂—É—Ä–Ω–∞–ª—ã, –∏ —Ç.–¥.


