# –¶–∏–∫–ª—ã, —É—Å–ª–æ–≤–∏—è, —Ñ—É–Ω–∫—Ü–∏–∏

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å –∏—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞–º–∏, —Ç.–µ. —Ç–∞–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é. –û–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ —Ä–∞–∑: –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ä–∞–∑—É 100 —Ñ–∞–π–ª–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫ –∏–∑ –±–æ–ª—å—à–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ—Ä–ø—É—Å–∞. 

–û–±—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ —Ç–∞–∫–æ–≤–æ: –µ—Å–ª–∏ –≤—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –∫—É—Å–æ–∫ –∫–æ–¥–∞ –±–æ–ª—å—à–µ —Ç—Ä–µ—Ö —Ä–∞–∑, —Ç–æ —Å–∞–º–æ–µ –≤—Ä–µ–º—è –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ–± –∏—Ç–µ—Ä–∞—Ü–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ —Å–¥–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–º –∏ —á–∏—Ç–∞–µ–º—ã–º. 


## –¶–∏–∫–ª—ã –∏ –∏—Ö –∞–Ω–∞–ª–æ–≥–∏

–•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å: –º–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ R —É–∂–µ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –∏ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –≤–µ–∫—Ç–æ—Ä–∞,  –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è _–≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è_. 

–ù–∞–ø—Ä–∏–º–µ—Ä, —É –Ω–∞—Å –µ—Å—Ç—å —Å–∏–º–≤–æ–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä, –∏ –º—ã —Ö–æ—Ç–∏–º —É–∑–Ω–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∫–∞–∂–¥–æ–º —Å–ª–æ–≤–µ.

```{r}
homer <- c("–≤", "–º—ã—Å–ª–∏", "–µ–º—É", "—Ç–æ", "–≤–ª–æ–∂–∏–ª–∞", "–±–æ–≥–∏–Ω—è", "–¥–µ—Ä–∂–∞–≤–Ω–∞—è", "–≥–µ—Ä–∞")
```

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–µ–∫—Ç–æ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω—É –∏—Ç–µ—Ä–∞—Ü–∏—é —Ü–∏–∫–ª–∞, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ -- –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `nchar()`. –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∫–∞–∫-—Ç–æ —Ç–∞–∫:

```{r}
for(i in homer) print(nchar(i))
```

:::{.callout-note icon=false}
–í —Ü–∏–∫–ª–∞—Ö —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—É–∫–≤–∞ `i`. –ù–æ –Ω–∏–∫–∞–∫–æ–π –æ—Å–æ–±–æ–π –º–∞–≥–∏–∏ –≤ –Ω–µ–π –Ω–µ—Ç, –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å.
:::

–ú—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Ü–∏–∫–ª `for`, –∫–æ—Ç–æ—Ä—ã–π —Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –≤ –≤–µ–∫—Ç–æ—Ä–µ. –ö–∞–∫ –≤–∏–¥–Ω–æ, –≤—Å–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ. –ù–æ –≤ R —ç—Ç–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ `nchar()` —É–∂–µ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∞:

```{r}
nchar(homer)
```

–≠—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ –º–Ω–æ–≥–∏–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º R, –Ω–æ –∏ –∫ –¥–∞–∂–µ –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º. `x + 4` –≤ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π `+(x, 4)`:

```{r}
x <- c(1.2, 2.51, 3.8)

`+`(x, 4) 
```

–ö–ª—é—á–µ–≤—É—é —Ä–æ–ª—å –∑–¥–µ—Å—å –∏–≥—Ä–∞–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –æ –∫–æ—Ç–æ—Ä–æ–π –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –≤ –ø–µ—Ä–≤–æ–º —É—Ä–æ–∫–µ: –∫–æ—Ä–æ—Ç–∫–∏–π –≤–µ–∫—Ç–æ—Ä –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –µ–≥–æ –¥–ª–∏–Ω–∞ –Ω–µ —Å—Ä–∞–≤–Ω—è–µ—Ç—Å—è —Å –¥–ª–∏–Ω–æ–π –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞. –ö–∞–∫-—Ç–æ —Ç–∞–∫:

$$ \left(
    \begin{array}{c}
      1.2 \\
      2.51 \\
      3.8
    \end{array}
  \right) + \left(
    \begin{array}{c}
      4 \\
      4 \\
      4
    \end{array}
  \right) $$


–õ–∏—à–Ω–∏–π —Ü–∏–∫–ª –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä–∏–º. –î–∞–Ω –≤–µ–∫—Ç–æ—Ä `x <- c(3, 5, 7, 13)`. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–∑–≤–µ—Å—Ç–∏ –≤ –∫–≤–∞–¥—Ä–∞—Ç –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ, –∞ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã—á–µ—Å—Ç—å 100. –í—ã–ø–æ–ª–Ω–∏–º –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏. 

```{r}
library(tictoc)
x <- c(2, 3, 5, 7, 11, 13)

# —Å–ø–æ—Å–æ–± –ø–µ—Ä–≤—ã–π
tic()
for (i in x) print(i^2 - 100)
toc()

# —Å–ø–æ—Å–æ–± –≤—Ç–æ—Ä–æ–π 
tic()
x^2 - 100
toc()
```

> –û–¥–∏–Ω –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ R –≥–ª–∞—Å–∏—Ç, —á—Ç–æ —Å–ª–µ–¥—É–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å—Å—è –±–µ–∑ —Ü–∏–∫–ª–æ–≤, –∞ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, —Ç–æ —Ü–∏–∫–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º–∏.
>
> --- –ù–æ—Ä–º–∞—Ç –ú—ç—Ç–ª–æ—Ñ—Ñ

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ —Ü–∏–∫–ª—ã —Ç–æ–∂–µ —á–∞—â–µ –≤—Å–µ–≥–æ –∏–∑–±—ã—Ç–æ—á–Ω—ã. –°–Ω–æ–≤–∞ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Å–ø–∏—Å–∫–æ–º –ø–µ—á–µ–Ω–µ–∫ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `rcorpora`.


```{r}
library(rcorpora)
my_list <-  corpora("foods/breads_and_pastries")
paste("–î–ª–∏–Ω–∞ —Å–ø–∏—Å–∫–∞:", length(my_list))
names(my_list)
```
–ö–∞–∫ —É–∑–Ω–∞—Ç—å –¥–ª–∏–Ω—É –∫–∞–∂–¥–æ–≥–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤ —Å–ø–∏—Å–æ–∫ –≤–µ–∫—Ç–æ—Ä–∞? –ü–æ–ø—Ä–æ–±—É–µ–º —Ü–∏–∫–ª (—Å–Ω–æ–≤–∞ –∑–∞–º–µ—Ç–∏–º –≤—Ä–µ–º—è):

```{r}
tic()
for (i in 1:length(my_list)) print(length(my_list[[i]]))
toc()
```

–ù–æ –≤ –±–∞–∑–æ–≤–æ–º R –¥–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—ã `lapply()` –∏ `sapply()`. –û–Ω–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–∞ –≤—Ö–æ–¥–µ —Å–ø–∏—Å–æ–∫ –∏ —Ñ—É–Ω–∫—Ü–∏—é –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç —Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É —Å–ø–∏—Å–∫–∞. –ü–æ–ª—É—á–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ:  

```{r}
tic()
lapply(my_list, length)
toc()
```
–§—É–Ω–∫—Ü–∏—è `sapply()` —É–ø—Ä–æ—Å—Ç–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ –≤–µ–∫—Ç–æ—Ä–∞ (s –æ–∑–Ω–∞—á–∞–µ—Ç simplify):

```{r}
tic()
sapply(my_list, length)
toc()
```

–ï—Å–ª–∏ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–æ—Ä–ø—É—Å, —Ç–æ —Ç–∞–∫ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª—É—á–∞–π–Ω—É—é –≤—ã–±–æ—Ä–∫—É. –ó–∞–º–µ—Ç—å—Ç–µ, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–Ω—ã –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ `sample()`.

```{r}
lapply(my_list[2:3], sample, 5, replace = TRUE)
```
–ú–æ–∂–µ—Ç –±—ã—Ç—å, —Å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞–º–∏ –±—É–¥—É—Ç –ø–æ–ª–µ–∑–Ω—ã —Ü–∏–∫–ª—ã? –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫.

```{r}
df <- data.frame(author=c("Joe","Jane"), year=c(1801,1901), reprints=c(TRUE,FALSE))
df
```

```{r}
tic()
for (i in seq_along(df)) {
 print(class(df[,i]))
}
toc()
```
–ù–æ –∏ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å—Å—è. –í—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç `apply` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å–æ —Å—Ç–æ–ª–±—Ü–∞–º–∏ (1 - —Å—Ç—Ä–æ–∫–∏).

```{r}
tic()
apply(df, 2, class)
toc()
```

–ï—Å—Ç—å –µ—â–µ `vapply()`, `tapply()` –∏  `mapply()`, –Ω–æ –∏ –ø—Ä–æ –Ω–∏—Ö –º—ã –Ω–µ –±—É–¥–µ–º –º–Ω–æ–≥–æ –≥–æ–≤–æ—Ä–∏—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—Å–µ –∏—Ö —Å —É—Å–ø–µ—Ö–æ–º –∑–∞–º–µ–Ω—è–µ—Ç —Å–µ–º–µ–π—Å—Ç–≤–æ `map_()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `purrr` –≤ `tidyverse`. 

::: {.callout-warning icon=false}
–ü—Ä–æ–π–¥–∏—Ç–µ —É—Ä–æ–∫ 10 `lapply and sapply` –∏ —É—Ä–æ–∫ 11 `vapply and tapply` –∏–∑ –∫—É—Ä—Å–∞ `R Programming` –≤ `swirl`.
:::

–¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –ø–µ—Ä–µ–¥ –æ—Å–≤–æ–µ–Ω–∏–µ–º —Å–µ–º–µ–π—Å—Ç–≤–∞ `map_()` —Å—Ç–æ–∏—Ç –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–±—ã—á–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤–∞–º –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –∏–º–µ—Ç—å —Å –Ω–∏–º–∏ –¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ Python). –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏, —Ü–∏–∫–ª `for` –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–µ–Ω –∏ —á–∞—Å—Ç–æ –ø—Ä–æ—â–µ –Ω–∞—á–∏–Ω–∞—Ç—å –∏–º–µ–Ω–Ω–æ —Å –Ω–µ–≥–æ. –ü–æ—ç—Ç–æ–º—É, –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–≤–∏–Ω—É—Ç—å—Å—è –¥–∞–ª—å—à–µ, —Å–¥–µ–ª–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏–∑ [@wickham2016, 316].


:::{.callout-warning icon=false}

(@) –ü–æ—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ `mtcars`.
(@) –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö `nycflights13::flights`.
(@) –ü–æ—Å—á–∏—Ç–∞–π—Ç–µ —á–∏—Å–ª–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ `iris`.
(@) –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ 10 —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –∏–∑ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è - —ç—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è  `rnorm()` - —Å–æ —Å—Ä–µ–¥–Ω–∏–º -10, 0, 10.

:::


:::{.callout-warning icon=false}
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Ü–∏–∫–ª–∞ `r emo::ji("silly")`.
:::

```{r}
# —Å—Ç–æ–∏—Ç –∑–∞–≥–ª—è–Ω—É—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ —Ñ—É–Ω–∫—Ü–∏–∏
out <- ""
for (x in letters) {
  out <- stringr::str_c(out, x)
}

# –æ—Ç–≤–µ—Ç - –≤—Å–µ–≥–æ –ø—è—Ç—å —Å–∏–º–≤–æ–ª–æ–≤...
x <- sample(100)
sd <- 0
for (i in seq_along(x)) {
  sd <- sd + (x[i] - mean(x)) ^ 2
}
sd <- sqrt(sd / (length(x) - 1))

# –Ω–∞–¥–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ç—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç 
x <- runif(100)
out <- vector("numeric", length(x))
out[1] <- x[1]
for (i in 2:length(x)) {
  out[i] <- out[i - 1] + x[i]
}
```


## –£—Å–ª–æ–≤–∏—è

–ò–Ω–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–∫–∏–º —É—Å–ª–æ–≤–∏–µ–º. –ö–æ—Ä–æ—Ç–∫–∏–µ —É—Å–ª–æ–≤–∏—è –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –±–µ–∑ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–æ–∫.

```{r}
y <-  "–≠–π—è—Ñ—å—è—Ç–ª–∞–π–æ–∫—É–¥–ª—å"

if(nchar(y) > 10) print("–º–Ω–æ–≥–æ –±—É–∫–≤")
```

–ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ç—Ä–µ–±—É—é—Ç —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–æ–∫. –ú–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —ç—Ç–æ —Å —É—Å–ª–æ–≤–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º: –ø—Ä–æ—Ç–∞—Å–∏—Å (–≤—Å–µ–≥–¥–∞ –ª–∏–±–æ TRUE, –ª–∏–±–æ FALSE) –≤ –∫—Ä—É–≥–ª—ã—Ö —Å–∫–æ–±–∫–∞—Ö, –∞–ø–æ–¥–æ—Å–∏—Å –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö.

```{r}
if (nchar(y) > 10) {
  print("–º–Ω–æ–≥–æ –±—É–∫–≤")
} else if (nchar(y) < 5) {
  print("–º–∞–ª–æ –±—É–∫–≤")
} else {
  print("–Ω–æ—Ä–º –±—É–∫–≤")
}
```

–¢–∞–∫–∂–µ –≤ R –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é:

```{r}
ifelse(nchar(y) > 10, "–º–Ω–æ–≥–æ –±—É–∫–≤", "–º–∞–ª–æ –±—É–∫–≤")
```

–ü—Ä–æ–ø–∏—Å—ã–≤–∞—è —É—Å–ª–æ–≤–∏–µ, –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ, —á—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±—É–ª–µ–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∫ –≤–µ–∫—Ç–æ—Ä—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–π –≤–µ–∫—Ç–æ—Ä:

```{r}
x <- c(1:10)
x >= 5
```

–¢–∞–∫–æ–µ —É—Å–ª–æ–≤–∏–µ –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É.

```{r error=TRUE}
if (x >= 5) print("–≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å")
```

–ú–æ–∂–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —Ç–∞–∫:

```{r}
if (any(x >= 5)) print("–≤—Å–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ")
```

–ü–æ —Ç–æ–π –∂–µ –ø—Ä–∏—á–∏–Ω–µ –≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `|` ("–∏–ª–∏") –∏–ª–∏ `&` ("–∏"), –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã:

```{r}
x < 3 | x > 7
```

## –§—É–Ω–∫—Ü–∏–∏

–§—É–Ω–∫—Ü–∏—è –∏ –∫–æ–¥ -- –Ω–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ. –ß—Ç–æ–±—ã —Å—Ç–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫—É—Å–æ–∫ –∫–æ–¥–∞ –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –∏–º—è. –ù–æ –∑–∞—á–µ–º –¥–∞–≤–∞—Ç—å –∏–º—è –∫–æ–¥—É, –∫–æ—Ç–æ—Ä—ã–π –∏ —Ç–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–í–æ—Ç —Ç—Ä–∏ –ø—Ä–∏—á–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ [–ø—Ä–∏–≤–æ–¥–∏—Ç](https://r4ds.had.co.nz/functions.html) –•–∞–¥–ª–∏ –£–∏–∫—Ö–µ–º:

-   —É —Ñ—É–Ω–∫—Ü–∏–∏ –µ—Å—Ç—å –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–µ –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –æ–±–ª–µ–≥—á–∞–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–¥–∞;
-   –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–¥ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ –Ω–µ –≤–æ –º–Ω–æ–≥–∏—Ö;
-   –º–µ–Ω—å—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–ª—É—á–∞–π–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –Ω–æ –Ω–µ –≤ –¥—Ä—É–≥–æ–º)

> Writing good functions is a lifetime journey.
>
> --- Hadley Wickham

–ú–∞—à–∏–Ω–µ –≤—Å–µ —Ä–∞–≤–Ω–æ, –∫–∞–∫ –≤—ã –Ω–∞–∑–æ–≤–µ—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –Ω–æ —Ç–µ–º, –∫—Ç–æ –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å –∫–æ–¥, –Ω–µ –≤—Å–µ —Ä–∞–≤–Ω–æ. –ò–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤—ã (–ø–æ—ç—Ç–æ–º—É —Ñ—É–Ω–∫—Ü–∏—è `f()` -- –ø–ª–æ—Ö–∞—è –∏–¥–µ—è). –¢–∞–∫–∂–µ –Ω–µ —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤ R –∏–º–µ–Ω–∞!

–î–∞–ª–µ–µ —Å–ª–µ–¥—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å _—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã_ –∏, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, _–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é_. –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∏—à–µ—Ç—Å—è –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö. –í –∫–æ–Ω—Ü–µ –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `return()`; –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç, —Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Å–º. [–∑–¥–µ—Å—å](https://r4ds.had.co.nz/functions.html) –æ —Ç–æ–º, –∫–æ–≥–¥–∞ —á—Ç–æ –ø—Ä–µ–¥–ø–æ—á–µ—Å—Ç—å).

–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π -- –Ω–∞–≤—ã–∫, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å. –ù–∞—á–∞—Ç—å –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ —Å –æ–±—ã—á–Ω–æ–≥–æ –∫–æ–¥–∞. –£–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ, –≤—ã –º–æ–∂–µ—Ç–µ —É–ø–∞–∫–æ–≤–∞—Ç—å –µ–≥–æ –≤ —Ñ—É–Ω–∫—Ü–∏—é.

–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–º –Ω—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∏—â–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ –¥–≤—É—Ö –≤–µ–∫—Ç–æ—Ä–∞—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–≤–ø–∞–≤—à–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã. –°–Ω–∞—á–∞–ª–∞ —Ä–µ—à–∏–º –∑–∞–¥–∞—á—É –¥–ª—è –¥–≤—É—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤.

```{r}
line1 <- c("–≥–Ω–µ–≤", "–±–æ–≥–∏–Ω—è", "–≤–æ—Å–ø–æ–π")
line2 <- c("–≤", "–º—ã—Å–ª–∏", "–µ–º—É", "—Ç–æ", "–≤–ª–æ–∂–∏–ª–∞", "–±–æ–≥–∏–Ω—è", "–¥–µ—Ä–∂–∞–≤–Ω–∞—è", "–≥–µ—Ä–∞")
idx <- which(line2 %in% line1) # 2
line2[idx]
```

–¢–µ–ø–µ—Ä—å –∑–∞–º–µ–Ω—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ.

```{r}
common_words <- function(x, y){
  idx <- which(x %in% y)
  x[idx]
}
```

–ò –ø—Ä–∏–º–µ–Ω—è–µ–º –∫ –Ω–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º.

```{r}
line3 <- c("–ª–∏—à—å", "—è–≤–∏–ª–∞—Å—å", "–∑–∞—Ä—è", "—Ä–æ–∑–æ–ø–µ—Ä—Å—Ç–∞—è", "–≤–µ—Å—Ç–Ω–∏—Ü–∞", "—É—Ç—Ä–∞")
line4 <- c("–≤–µ—Å—Ç–Ω–∏—Ü–∞", "—É—Ç—Ä–∞", "–∑–∞—Ä—è", "–Ω–∞", "–≤–µ–ª–∏–∫–∏–π", "–æ–ª–∏–º–ø", "–≤–æ—Å—Ö–æ–¥–∏–ª–∞")
common_words(line4, line3)
```

::: {.callout-warning icon=false}
–ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `swirl`, –≤—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å `R Programming` –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∏–∑ –Ω–µ–≥–æ —É—Ä–æ–∫ 9 `Functions`.
:::

::: {.callout-tip icon=false}
–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –ª—é–±–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ...
:::

```{r echo=FALSE}
library(checkdown)
check_question(
  answer = "–Ω–∞–±—Ä–∞—Ç—å –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –±–µ–∑ —Å–∫–æ–±–æ–∫",
  options = c("–Ω–∞–±—Ä–∞—Ç—å –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –±–µ–∑ —Å–∫–æ–±–æ–∫", "–≤—ã–∑–≤–∞—Ç—å help –∫ —Ñ—É–Ω–∫—Ü–∏–∏", "–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî –Ω–∞–π—Ç–∏ –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub", "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–¥–∞"),
  right = "–í—Å–µ –≤–µ—Ä–Ω–æ!", 
  wrong = "–ù–µ —Å–æ–≤—Å–µ–º...", 
  type = "radio",
  random_answer_order = TRUE)
```

</br>

–ù–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —Ç–æ –µ—Å—Ç—å –≤—ã—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω–µ–µ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (–∑–∞–±—É–¥–µ–º –Ω–∞ –≤—Ä–µ–º—è, —á—Ç–æ —ç—Ç–æ —É–∂–µ –¥–µ–ª–∞–µ—Ç –±–∞–∑–æ–≤–∞—è `scale()`):

```{r}
center <- function(x){ 
  n = x - mean(x)
  return(n) 
}

x <- c(5, 10, 15)
center(x) 
```

–í–Ω—É—Ç—Ä–∏ –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `n`, –∫–æ—Ç–æ—Ä—É—é –Ω–µ –≤–∏–¥–Ω–æ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –≠—Ç–æ _–ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è_. –û–±–ª–∞—Å—Ç—å –µ–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ -- —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏. –ö–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏—Å—á–µ–∑–∞–µ—Ç. –û–±—Ä–∞—Ç–Ω–æ–µ –Ω–µ–≤–µ—Ä–Ω–æ: –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏.

–§—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –î–æ—Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞—à –∫–æ–¥:

```{r}
center <- function(x, na.rm = F){
  if(na.rm) { x <- x[!is.na(x)]} # –¥–æ–±–∞–≤–∏–º —É—Å–ª–æ–≤–∏–µ
  x - mean(x) # –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –±–µ–∑ return()
}

x <- c(5, 10, NA)
center(x)
```

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ? –ü–æ—á–µ–º—É —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –≤—ã–¥–∞–µ—Ç –¥—Ä—É–≥–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?

```{r}
center(x, na.rm = T)
```

–í—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ R _–ª–µ–Ω–∏–≤—ã_, —Ç–æ –µ—Å—Ç—å –æ–Ω–∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ï—Å–ª–∏ –≤—ã –∑–∞–¥–∞–¥–∏—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω—É–∂–µ–Ω –≤ —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏, –æ—à–∏–±–∫–∏ –Ω–µ –±—É–¥–µ—Ç.

```{r}
center <- function(x, na.rm = F, what_is_your_name){
  if(na.rm) { x <- x[!is.na(x)]} # –¥–æ–±–∞–≤–∏–º —É—Å–ª–æ–≤–∏–µ
  x - mean(x) # –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –±–µ–∑ return()
}

center(x, na.rm = T)
center(x, na.rm = T, what_is_your_name = "Locusclassicus")
```

–ß–∞—Å—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –¥–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Ä–∞—Å–ø–µ—á–∞—Ç–∞–Ω–æ –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏.

```{r eval=FALSE}
center <- function(x){
  if (length(x) == 1) {stop("–û—Ç—Å—Ç–∞–Ω—å, —Å—Ç–∞—Ä—É—à–∫–∞, —è –≤ –ø–µ—á–∞–ª–∏.")}
  x - mean(x) # –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –±–µ–∑ return()
}

x <- 10
center(x) # –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É
```


:::{.callout-warning icon=false}
–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `awesome_plot`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –¥–≤–∞ –≤–µ–∫—Ç–æ—Ä–∞, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ —Ç–∏–±–±–ª –∏ —Å—Ç—Ä–æ–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É —Ä–∞—Å—Å–µ—è–Ω–∏—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ ggplot(). –ó–∞–¥–∞–π—Ç–µ —Ü–≤–µ—Ç –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç–æ—á–µ–∫, –∞ –≤ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–µ –≤—ã–≤–µ–¥–∏—Ç–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏.
:::

:::{.callout-warning icon=false}

(@) –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞—Å–ø–µ—á–∞—Ç–∞–µ—Ç —Å—Ç–∏—Ö–∏ –¥–µ—Ç—Å–∫–æ–π –ø–µ—Å–Ω–∏ ["Alice the Camel"](https://supersimple.com/song/alice-the-camel/). 

(@) –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ –¥–µ—Ç—Å–∫—É—é –ø–æ—Ç–µ—à–∫—É ["Ted in the Bed"](https://supersimple.com/song/ten-in-the-bed/) –≤ —Ñ—É–Ω–∫—Ü–∏—é. –û–±–æ–±—â–∏—Ç–µ –¥–æ –ª—é–±–æ–≥–æ —á–∏—Å–ª–∞ —Å–ø—è—â–∏—Ö. 

(@) –ó–∞–ø–∏—à–∏—Ç–µ –≤ –≤–∏–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ ["99 Bottles of Beer on the Wall"](https://www.99-bottles-of-beer.net/lyrics.html). –û–±–æ–±—â–∏—Ç–µ –¥–æ –ª—é–±–æ–≥–æ —á–∏—Å–ª–∞ –ª—é–±—ã—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤ –Ω–∞ –ª—é–±–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.

:::

:::{.callout-warning icon=false}
–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å "–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ", "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å" –∏–ª–∏ "–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä" –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `lubridate::now()` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. 
:::


## Purrr

–ü–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–π -- —ç—Ç–æ –ø–∞–∫–µ—Ç `purrr` –∏–∑ —Å–µ–º–µ–π—Å—Ç–≤–∞ [`tidyverse`](https://purrr.tidyverse.org/). –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—Ç, —á—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –æ–≤–ª–∞–¥–µ—Ç—å —ç—Ç–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º [@wickham2016].

> You should never feel bad about using a loop instead of a map function. The map functions are a step up a tower of abstraction, and it can take a long time to get your head around how they work.
>
> --- Hadley Wickham & Garrett Grolemund

–í —Å–µ–º–µ–π—Å—Ç–≤–µ —Ñ—É–Ω–∫—Ü–∏–π `map_` –∏–∑ —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –≤—Å–µ–≥–æ [23 –≤–∞—Ä–∏–∞—Ü–∏–∏](https://adv-r.hadley.nz/functionals.html). –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–∑ –Ω–∏—Ö:

-   `map()`
-   `map_lgl()`
-   `map_int()`
-   `map_dbl()`
-   `map_chr()`

–í—Å–µ –æ–Ω–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–∞ –≤—Ö–æ–¥–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏—é (–∏–ª–∏ —Ñ–æ—Ä–º—É–ª—É), –∫–æ—Ç–æ—Ä—É—é —Å–ª–µ–¥—É–µ—Ç –∫ –Ω–∏–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å, –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–æ–º –≤–∏–¥–µ, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑–∞–Ω –ø–æ—Å–ª–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è. –ü—Ä–æ—Å—Ç–æ `map()` –≤–µ—Ä–Ω–µ—Ç —Å–ø–∏—Å–æ–∫, –∞ `map_int()` -- —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä, –∏ —Ç.–¥. 

–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ `purrr`, —á—Ç–æ–±—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç `starwars` –∏–∑ –ø–∞–∫–µ—Ç–∞ `dplyr`. –î–ª—è –Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–µ–º —á–∏—Å–ª–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ. –ö–æ—Å–∞—è —á–µ—Ä—Ç–∞ (`\`) —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

```{r message=FALSE}
library(tidyverse)
starwars <- starwars
map_int(starwars, \(x) sum(is.na(x)))
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `map_int`, –∫–∞–∫ –∏ `map_dbl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä. –ß—Ç–æ–±—ã –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –∏–º–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `unname()`:

```{r}
map_chr(starwars, class) |> 
  unname()
```

:::{.task .code}
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `map_dbl` –∏ `n_distinct`, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —á–∏—Å–ª–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ.
:::


–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∏—Ö –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø–æ—Å–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –¥–ª—è _–∫–∞–∂–¥–æ–≥–æ_ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞. –í –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ —ç—Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç `na.rm`.

```{r}
starwars |> 
  select(mass, height) |> 
  map(mean, na.rm = TRUE)
```
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `map_df` –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è –∞—Ä–≥—É–º–µ–Ω—Ç `.id`:

```{r}
starwars |> 
  map_df(~data.frame(unique_values = n_distinct(.x),
                     col_class = class(.x)),
         .id = "variable"
         )
```

–§—É–Ω–∫—Ü–∏–∏ `map` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é. 
–î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —Å–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é `describe_vec()`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –¥–ª–∏–Ω–æ–π –∏ –∫–ª–∞—Å—Å–æ–º –≤–µ–∫—Ç–æ—Ä–∞, –∏ –ø—Ä–∏–º–µ–Ω–∏–º –µ–µ –∫ —Ö–ª–µ–±–æ-–±—É–ª–æ—á–Ω–æ–º—É —Å–ø–∏—Å–∫—É –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—ã—à–µ.

```{r}
# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è
describe_vec <- function(vec){
  l = paste("–î–ª–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞: ", length(vec))
  c = paste("–ö–ª–∞—Å—Å –≤–µ–∫—Ç–æ—Ä–∞: ", class(vec))
  result = paste(l, c, sep = " | ")
  return(result)
}

map_chr(my_list, describe_vec) |> 
  unname()
```

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å `map` –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é (–≤–º–µ—Å—Ç–æ `function` –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `\`):

```{r}
map_chr(my_list, 
        function(x) paste("–î–ª–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞: ", length(x))
        )
```


–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∑—ã–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é —Å –¥–≤—É–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [`map2()`](https://adv-r.hadley.nz/functionals.html). –ê—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ, –ø–∏—à—É—Ç—Å—è –¥–æ —Ñ—É–Ω–∫—Ü–∏–∏; –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã, -- –ø–æ—Å–ª–µ.


```{r}
mean = list(5, 10, -3)
sd = list(1, 5, 50)
map2(mean, sd, rnorm, n = 5)
```

</br>

![_–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `map2()_`](https://d33wubrfki0l68.cloudfront.net/68a21c4a103426c3b311c9dcfad8fe379d4892f1/55c9d/diagrams/lists-map2.png){width="60%"}

</br>

–≠—Ç–æ –º–æ–∂–Ω–æ –æ–±–æ–±—â–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º ([–∏—Å—Ç–æ—á–Ω–∏–∫](https://adv-r.hadley.nz/functionals.html#map2){width="60%"}):

![](https://d33wubrfki0l68.cloudfront.net/7a545699ff7069a98329fcfbe6e42b734507eb16/211a5/diagrams/functionals/map2-arg.png)

–ú–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏ map3(), map4() –∏ —Ç.–¥., –Ω–æ –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞–µ—è—Ö, –∫–æ–≥–¥–∞ —É —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ–ª—å—à–µ –¥–≤—É—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pmap()`.


:::{.callout-warning icon=false}
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫—É—Ä—Å `swirl::install_course("Advanced R Programming")` –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∏–∑ –Ω–µ–≥–æ —É—Ä–æ–∫ 3 `Functional Programming with purrr`.
:::

–ù–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏.

:::{.callout-tip icon=false}
–§—É–Ω–∫—Ü–∏–∏-–ø—Ä–µ–¥–∏–∫–∞—Ç—ã (predicate functions) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `TRUE` –∏–ª–∏ `FALSE`. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏-–ø—Ä–µ–¥–∏–∫–∞—Ç—ã.
:::

```{r echo=F, results='asis'}
check_question(options = c("every()", "some()", "none()", "has_element()", "is.factor()", "keep()", "discard()", "is.numeric()", "detect()"), 
               type = "checkbox",
               answer = c("every()", "some()", "none()", "has_element()", "is.factor()", "is.numeric()"), 
               right = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!",
               wrong = "–ß—Ç–æ-—Ç–æ —Ç—É—Ç –ª–∏—à–Ω–µ–µ ü§î")
```

</br>

:::{.callout-tip icon=false}
–ö–∞–∫–∏–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –Ω–∏–∂–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç *–≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞* —Ñ—É–Ω–∫—Ü–∏–∏-–ø—Ä–µ–¥–∏–∫–∞—Ç—ã?
:::

```{r echo=F, results='asis'}
check_question(options = c("every()", "some()", "none()", "has_element()", "is.factor()", "keep()", "discard()", "is.numeric()", "detect()"), 
               type = "checkbox",
               answer = c("keep()", "discard()", "detect()"), 
               right = "–í–µ—Ä–Ω–æ!",
               wrong = "–ù–µ —Å–æ–≤—Å–µ–º ü§î")
```


## –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä: —Ü–∏–∫–ª vs. `map_()`

–ö–∞–∫ –≤—ã —É–∂–µ –ø–æ–Ω—è–ª–∏, –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –∑–∞–¥–∞—á–∏ –º–æ–∂–Ω–æ —Ä–µ—à–∞—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ü–∏–∫–ª–æ–≤ –∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ `map_`. –ú—ã –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –≤ 2023 –≥. –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ –ë—Ä–∏—Ç–∞–Ω—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (<https://www.bl.uk/>), –Ω–æ –ø–æ—Ç–æ–º –æ—Ç—Ç—É–¥–∞ –∏—Å—á–µ–∑ (–Ω–æ —É –Ω–∞—Å —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å –∫–æ–ø–∏—è). 

–î–∞—Ç–∞—Å–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤ .csv, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ä–µ—Å—É—Ä—Å–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä–æ–º, –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–π –ë—Ä–∏—Ç–∞–Ω—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ –æ–Ω –±—ã–ª –≤—ã–ø—É—â–µ–Ω –∫ 20-–ª–µ—Ç–∏—é –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–Ω–∏–≥–∏ ¬´–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä –∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∫–∞–º–µ–Ω—å¬ª 26 –∏—é–Ω—è 2017 –≥–æ–¥–∞ –∏ —Å —Ç–µ—Ö –ø–æ—Ä –µ–∂–µ–≥–æ–¥–Ω–æ –æ–±–Ω–æ–≤–ª—è–ª—Å—è. –í—Å–µ–≥–æ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –ø—è—Ç—å —Ñ–∞–π–ª–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. 

–°–∫–∞—á–∞–µ–º –∞—Ä—Ö–∏–≤.

```{r eval=FALSE}
my_url <- "https://github.com/locusclassicus/text_analysis_2024/raw/main/files/HP.zip"
download.file(url = my_url, destfile = "../files/HP.zip")
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –∞—Ä—Ö–∏–≤–æ–º –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –µ–≥–æ.

```{r eval=FALSE}
unzip("../files/HP.zip")
```

–°–æ—Ö—Ä–∞–Ω–∏–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .csv, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–¥—Ö–æ–¥—è—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ base R.

```{r}
my_files <- list.files("../files/HP", pattern = ".csv", full.names = TRUE)
my_files
```
### –¶–∏–∫–ª

–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–µ–º —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π

(1) –ø—Ä–æ—á–∏—Ç–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ my_files, –∏—Å–ø–æ–ª—å–∑—É—è –¥–ª—è —ç—Ç–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏—é read_csv() –∏–∑ –ø–∞–∫–µ—Ç–∞ readr;
(2) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –≤—ã—è—Å–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ _–±–µ–∑_ NA –≤ —Å—Ç–æ–ª–±—Ü–µ BNB Number;
(3) —Ä–∞–∑–¥–µ–ª–∏—Ç —á–∏—Å–ª–æ —Ç–∞–∫–∏—Ö —Ä—è–¥–æ–≤ –Ω–∞ –æ–±—â–µ–µ —á–∏—Å–ª–æ —Ä—è–¥–æ–≤;
(4) –≤–µ—Ä–Ω–µ—Ç —Ç–∞–±–ª–∏—Ü—É c —á–µ—Ç—ã—Ä—å–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏: 

    - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (id),
    - —á–∏—Å–ª–æ —Ä—è–¥–æ–≤ (total),
    - —á–∏—Å–ª–æ —Ä—è–¥–æ–≤ –±–µ–∑ NA (complete),
    - –¥–æ–ª—è –ø–æ–ª–Ω—ã—Ö —Ä—è–¥–æ–≤ (ratio).
  
–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É, –≤ –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ–º —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. 

```{r}
my_files_short <- list.files("../files/HP", pattern = ".csv")

my_df <- data.frame(id = my_files_short, 
                    total = 0,
                    complete = 0,
                    ratio = 0)

my_df
```

–¢–µ–ø–µ—Ä—å —Ç–µ–ª–æ —Ü–∏–∫–ª–∞:

```{r}
for (i in 1:length(my_files)) {

  # —á–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ñ–∞–π–ª –∏–∑ my_files
  current_file <- my_files[i]
  current_df <- readr::read_csv(current_file, show_col_types = FALSE) 

  # –≤—ã—è–≤–ª—è–µ–º –æ–±—â–µ–µ —á–∏—Å–ª–æ —Ä—è–¥–æ–≤ –∏ —á–∏—Å–ª–æ —Ä—è–¥–æ–≤ –±–µ–∑ NA –≤ BNB number
  # –∏–∑-–∑–∞ –ø—Ä–æ–±–µ–ª–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Å—Ç–æ–ª–±—Ü–∞ BNB number –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  # —Å –±—ç–∫—Ç–∏–∫–∞–º–∏ ``, –∞ –Ω–µ —Å "—Ç–∞–∫–∏–º–∏" –∏–ª–∏ '—Ç–∞–∫–∏–º–∏' –∫–∞–≤—ã—á–∫–∞–º–∏ 
  current_total <- nrow(current_df)
  current_complete <- sum(!is.na(current_df$`BNB number`))
    

  # –ø–æ–º–µ—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–º my_df –≤–º–µ—Å—Ç–æ –Ω—É–ª–µ–π
  my_df$total[i] <- current_total  
  my_df$complete[i] <- current_complete
  my_df$ratio[i] <- current_complete / current_total
}
```

–°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```{r}
my_df
```

### `map_()`

–¢–µ–ø–µ—Ä—å –∏—Å—Å–ª–µ–¥—É–µ–º –¥–∞—Ç–∞—Å–µ—Ç –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–≤. –ü—Ä–æ—á–∏—Ç–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–∏.

```{r}
# —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ 
HP <- map(my_files, read_csv, col_types = cols())
```

–û–±—ä–µ–∫—Ç `HP` -- —ç—Ç–æ —Å–ø–∏—Å–æ–∫. –í –Ω–µ–º –ø—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫ –∫–∞–∫ –Ω–∞ –≤—Ö–æ–¥–µ —É –Ω–∞—Å –±—ã–ª–æ –ø—è—Ç—å —Ñ–∞–π–ª–æ–≤. –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞–∑–Ω–∞—á–∏–º –∏–º–µ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–ø–∏—Å–∫–∞. 

```{r}
names(HP) <- my_files_short
```

![](images/HP.png)

–ù–∞—á–Ω–µ–º —Å –ø—Ä–æ—Å—Ç–æ–≥–æ: –ø—Ä–∏ –ø–æ–º–æ—â–∏ `map` –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å —Å—Ç–æ–ª–±—Ü—ã (–ø–æ –∏–º–µ–Ω–∏) –∏–ª–∏ —Ä—è–¥—ã (–ø–æ —É—Å–ª–æ–≤–∏—é) –∏–∑ –≤—Å–µ—Ö –ø—è—Ç–∏ —Ç–∞–±–ª–∏—Ü. –ü—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –Ω–∏–∂–µ, –ø–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. 

```{r eval=FALSE}
# –∏–∑–≤–ª–µ—á—å —Å—Ç–æ–ª–±—Ü—ã
map(HP, select, `BNB number`)

# –∏–∑–≤–ª–µ—á—å —Ä—è–¥—ã
map(HP, filter, !(is.na(`BNB number`)))
```

:::{.callout-warning icon=false}
–ò–∑–≤–ª–µ–∫–∏—Ç–µ –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è (—Å—Ç–æ–ª–±–µ—Ü `Title`) –∏–∑ –≤—Å–µ—Ö –ø—è—Ç–∏ —Ç–∞–±–ª–∏—Ü –≤ `HP`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `distinct`. 
:::


–ß—Ç–æ, –µ—Å–ª–∏ –º—ã –Ω–µ –∑–Ω–∞–µ–º –∑–∞—Ä–∞–Ω–µ–µ, –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã –µ—Å—Ç—å _–≤–æ –≤—Å–µ—Ö –ø—è—Ç–∏ —Ç–∞–±–ª–∏—Ü–∞—Ö_, –∏ —Ö–æ—Ç–∏–º —ç—Ç–æ –≤—ã—è—Å–Ω–∏—Ç—å? –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥–æ–π–¥–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `reduce()` –∏–∑ —Ç–æ–≥–æ –∂–µ `purrr`. –û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥–µ –≤–µ–∫—Ç–æ—Ä (–∏–ª–∏ —Å–ø–∏—Å–æ–∫) –∏  —Ñ—É–Ω–∫—Ü–∏—é –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∫ –∫–∞–∂–¥–æ–π –ø–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–∏–π.

![[_–ò—Å—Ç–æ—á–Ω–∏–∫_.](https://adv-r.hadley.nz/functionals.html#reduce)](https://d33wubrfki0l68.cloudfront.net/9c239e1227c69b7a2c9c2df234c21f3e1c74dd57/eec0e/diagrams/functionals/reduce.png){ width="60%" }

</br>

–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —ç—Ç–∏–º, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤.

```{r}
map(HP, colnames) |> 
  reduce(intersect)
```

–ï—â–µ –æ–¥–Ω–∞ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ `reduce` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü –≤ –æ–¥–Ω—É –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫:

```{r message=FALSE}
HP_joined <- HP |> 
  reduce(left_join)

HP_joined
```

### EDA

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–≤–µ–¥—ã–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤.

```{r warning=FALSE, message=FALSE}
library(ggplot2)
library(tidyr)

data_sum <- HP_joined |> 
  separate(`Date of publication`, into = c("year", NA)) |> 
  separate(`Country of publication`, into = c("country", NA), sep = ";") |>
  mutate(country = str_squish(country)) |> 
  mutate(country = 
           case_when(country == "England" ~ "United Kingdom",
                     country == "Scotland" ~ "United Kingdom",
                     TRUE ~ country)) |> 
  filter(!is.na(year)) |> 
  filter(!is.na(country)) |> 
  group_by(year, country) |> 
  summarise(n = n()) |> 
  arrange(-n)
  

data_sum
```


```{r}
data_sum |> 
  ggplot(aes(year, n, fill = country)) + 
  geom_col() + 
  xlab(NULL) +
  theme(axis.text.x = element_text(angle = 90))
```

–í –∫–∞—á–µ—Å—Ç–≤–µ –Ω–µ–±–æ–ª—å—à–æ–≥–æ –±–æ–Ω—É—Å–∞ –∫ —ç—Ç–æ–º—É —É—Ä–æ–∫—É –ø–æ—Å—Ç—Ä–æ–∏–º –æ–±–ª–∞–∫–æ —Å–ª–æ–≤. –í–µ–∫—Ç–æ—Ä —Å–ª–æ–≤ –≤–æ–∑—å–º–µ–º –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ `Topic`. 

```{r warning=FALSE}
data_topics <- HP_joined |> 
  filter(!is.na(Topics)) |> 
  separate(Topics, into = c("topic", NA)) |> 
  mutate(topic = tolower(topic)) |> 
  group_by(topic) |> 
  summarise(n = n()) |> 
  filter(!topic %in% c("harry", "rowling", "potter", "children", "literary"))


pal <- c("#f1c40f", "#34495e", 
         "#8e44ad", "#3498db",
         "#2ecc71")

library(wordcloud)
par(mar = c(1, 1, 1, 1))
wordcloud(data_topics$topic, 
          data_topics$n,
          min.freq = 3,
          #max.words = 50, 
          scale = c(3, 0.8),
          colors = pal, 
          random.color = T, 
          rot.per = .2,
          vfont=c("script","plain")
          )
```

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–ª–∞–∫–æ —Å–ª–æ–≤ –º–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–∫–µ—Ç–∞ `wordcloud2`. –°–¥–µ–ª–∞–µ–º –æ–±–ª–∞–∫–æ –≤ —Ñ–æ—Ä–º–µ —à–ª—è–ø—ã –≤–æ–ª—à–µ–±–Ω–∏–∫–∞!

```{r eval=FALSE}
# devtools::install_github("lchiffon/wordcloud2")
library(wordcloud2)


wordcloud2(data_topics, 
           figPath = "./book/images/Wizard-Hat.png",
           size = 1.5,
           backgroundColor="black",
           color="random-light", 
           fontWeight = "normal",
)

```

![](./images/hat_wordcloud.jpg)

–¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–∏. 

:::{.callout-warning icon=false}
–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ "–ê–ª–∏—Å–∞ –≤ —Å—Ç—Ä–∞–Ω–µ —á—É–¥–µ—Å"
:::


```{r eval=FALSE}
# –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –æ–±–ª–∞–∫–æ —Å–ª–æ–≤ –¥–ª—è "–ê–ª–∏—Å—ã –≤ —Å—Ç—Ä–∞–Ω–µ —á—É–¥–µ—Å"

library(languageR)
library(dplyr)
library(tidytext)

# –≤–µ–∫—Ç–æ—Ä —Å "–ê–ª–∏—Å–æ–π"
alice <- tolower(alice)

# —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–ª–æ–≤
freq <- as_tibble(table(alice)) |> 
  rename(word = alice)

# —É–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
freq_tidy <- freq |> 
  anti_join(stop_words) 
# –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

# –æ–±–ª–∞–∫–æ –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –≤ –ª—é–±–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
```

